!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-scenegraph"),require("d3-color")):"function"==typeof define&&define.amd?define(["exports","vega-scenegraph","d3-color"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).WevGPURenderer={},e.vega,e.d3)}(this,function(u,d,l){"use strict";function V(e,s,a,u){return new(a=a||Promise)(function(n,t){function r(e){try{o(u.next(e))}catch(e){t(e)}}function i(e){try{o(u.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,i)}o((u=u.apply(e,s||[])).next())})}function p(r,i){var o,s,a,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},l={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function e(n){return function(e){var t=[n,e];if(o)throw new TypeError("Generator is already executing.");for(;u=l&&t[l=0]?0:u;)try{if(o=1,s&&(a=2&t[0]?s.return:t[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,t[1])).done)return a;switch(s=0,(t=a?[2&t[0],a.value]:t)[0]){case 0:case 1:a=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,s=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!(a=0<(a=u.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){u=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3]))u.label=t[1];else if(6===t[0]&&u.label<a[1])u.label=a[1],a=t;else{if(!(a&&u.label<a[2])){a[2]&&u.ops.pop(),u.trys.pop();continue}u.label=a[2],u.ops.push(t)}}t=i.call(r,u)}catch(e){t=[6,e],s=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function x(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function m(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}i.from=function(e,t,n){var r;return void 0===t&&(t=1),void 0===n&&(n=1),e?e instanceof i?e:"transparent"===e?new i(0,0,0,0):e.id||e.gradient?(console.warn("Gradient not supported yet!"),new i(.5,1,1,+t*n)):(r={r:255,g:255,b:255,a:255},new i((r={r:(e=l.color(e).rgb()).r,g:e.g,b:e.b,a:e.opacity}).r/255,r.g/255,r.b/255,r.a*t*n)):new i(0,0,0,0)},i.from2=function(e,t,n){var r;return void 0===t&&(t=1),void 0===n&&(n=1),e?(r=i._cache[e])?[r[0],r[1],r[2],r[3]*t*n]:e instanceof i?[e.r,e.g,e.b,e.a]:"transparent"===e?[0,0,0,0]:e.id||e.gradient?(console.warn("Gradient not supported yet!"),[.5,1,1,+t*n]):(t=[(r=l.color(e).rgb()).r/255,r.g/255,r.b/255,r.opacity*t*n],i._cache[e]=[t[0],t[1],t[2],r.opacity],t):[0,0,0,0]},i.prototype[Symbol.iterator]=function(){var t,n,r,i;return p(this,function(e){switch(e.label){case 0:e.trys.push([0,5,6,7]),t=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.values),n=t.next(),e.label=1;case 1:return n.done?[3,4]:[4,n.value];case 2:e.sent(),e.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return r=e.sent(),r={error:r},[3,7];case 6:try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}return[7];case 7:return[2]}})},Object.defineProperty(i.prototype,"rgba",{get:function(){return[this.values[0],this.values[1],this.values[2],this.values[3]]},set:function(e){this.values[0]=e[0],this.values[1]=e[1],this.values[2]=e[2],this.values[3]=e[3]},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,0,{get:function(){return this.values[0]},set:function(e){this.values[0]=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"r",{get:function(){return this.values[0]},set:function(e){this.values[0]=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,1,{get:function(){return this.values[1]},set:function(e){this.values[1]=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"g",{get:function(){return this.values[1]},set:function(e){this.values[1]=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,2,{get:function(){return this.values[2]},set:function(e){this.values[2]=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"b",{get:function(){return this.values[2]},set:function(e){this.values[2]=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,3,{get:function(){return this.values[3]},set:function(e){this.values[3]=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"a",{get:function(){return this.values[3]},set:function(e){this.values[3]=e},enumerable:!1,configurable:!0}),i.cache={},i._cache={};var U=i;function i(e,t,n,r){void 0===r&&(r=1),this.values=[0,0,0,1],this.values[0]=e,this.values[1]=t,this.values[2]=n,this.values[3]=r}e.prototype.calculateLayouts=function(e){var r=[],i=0,t="vertex"===e?this.vertexFormats:this.instanceFormats,o="vertex"===e?this.vertexLocationOffset:this.instanceLocationOffset;return t.forEach(function(e,t){var n=function(e){switch(e){case"float16x2":return 4;case"float16x4":return 8;case"float32":return Float32Array.BYTES_PER_ELEMENT;case"float32x2":return 2*Float32Array.BYTES_PER_ELEMENT;case"float32x3":return 3*Float32Array.BYTES_PER_ELEMENT;case"float32x4":return 4*Float32Array.BYTES_PER_ELEMENT;case"sint8x2":case"snorm8x2":return 2*Int8Array.BYTES_PER_ELEMENT;case"sint8x4":case"snorm8x4":return 4*Int8Array.BYTES_PER_ELEMENT;case"sint16x2":case"snorm16x2":return 2*Int16Array.BYTES_PER_ELEMENT;case"sint16x4":case"snorm16x4":return 4*Int16Array.BYTES_PER_ELEMENT;case"sint32":return Int32Array.BYTES_PER_ELEMENT;case"sint32x2":return 2*Int32Array.BYTES_PER_ELEMENT;case"sint32x3":return 3*Int32Array.BYTES_PER_ELEMENT;case"sint32x4":return 4*Int32Array.BYTES_PER_ELEMENT;case"uint32":return Uint32Array.BYTES_PER_ELEMENT;case"uint32x2":return 2*Uint32Array.BYTES_PER_ELEMENT;case"uint32x3":return 3*Uint32Array.BYTES_PER_ELEMENT;case"uint32x4":return 4*Uint32Array.BYTES_PER_ELEMENT;case"uint8x2":case"unorm8x2":return 2*Uint8Array.BYTES_PER_ELEMENT;case"uint8x4":case"unorm8x4":return 4*Uint8Array.BYTES_PER_ELEMENT;case"uint16x2":case"unorm16x2":return 2*Uint16Array.BYTES_PER_ELEMENT;case"uint16x4":case"unorm16x4":return 4*Uint16Array.BYTES_PER_ELEMENT;case"unorm10-10-10-2":return 4;default:return 0}}(e);0<n?(r.push({shaderLocation:t+o,offset:i,format:e}),i+=n):console.error("Unsupported format: ".concat(e))}),{arrayStride:i,stepMode:e,attributes:r}},e.prototype.calculateLength=function(e){var e="vertex"===e?this.vertexFormats:this.instanceFormats,n=0;return e.forEach(function(e,t){n+=function(e){switch(e){case"float32":case"uint32":case"sint32":return 1;case"uint8x2":case"sint8x2":case"unorm8x2":case"snorm8x2":case"uint16x2":case"sint16x2":case"unorm16x2":case"snorm16x2":case"float16x2":case"float32x2":case"uint32x2":case"sint32x2":return 2;case"float32x3":case"uint32x3":case"sint32x3":return 3;case"uint8x4":case"sint8x4":case"unorm8x4":case"snorm8x4":case"uint16x4":case"sint16x4":case"unorm16x4":case"snorm16x4":case"float16x4":case"float32x4":case"uint32x4":case"sint32x4":return 4;default:return 0}}(e)}),n},e.prototype.setDirty=function(){this.dirtyFlag=!0},e.prototype.pushFormat=function(e,t){("vertex"===e?this.vertexFormats:this.instanceFormats).push(t),this.setDirty()},e.prototype.pushFormats=function(e,t){e="vertex"===e?this.vertexFormats:this.instanceFormats;e.push.apply(e,m([],x(t),!1)),this.setDirty()},e.prototype.clear=function(){this.vertexFormats=[],this.instanceFormats=[],this.vertexLayout=null,this.instanceLayout=null,this.setDirty()},e.prototype.process=function(){this.dirtyFlag&&(this.vertexLayout=this.calculateLayouts("vertex"),this.instanceLayout=this.calculateLayouts("instance"),this.vertexLength=this.calculateLength("vertex"),this.instanceLength=this.calculateLength("instance"),this.dirtyFlag=!1)},e.prototype.getBuffers=function(){this.process();var e=[];return this.vertexLength&&this.vertexLayout&&e.push(this.vertexLayout),this.instanceLength&&this.instanceLayout&&e.push(this.instanceLayout),e},e.prototype.getVertexBuffer=function(){return this.process(),this.vertexLayout},e.prototype.getInstanceBuffer=function(){return this.process(),this.instanceLayout},e.prototype.getVertexLength=function(){return this.process(),this.vertexLength},e.prototype.getInstanceLength=function(){return this.process(),this.instanceLength};var y=e;function e(e,t,n,r){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=null),void 0===r&&(r=null),this.vertexFormats=[],this.instanceFormats=[],this.vertexLayout=null,this.instanceLayout=null,this.vertexLength=null,this.instanceLength=null,this.dirtyFlag=!0,this.vertexLocationOffset=0|n,this.instanceLocationOffset=r|n+e.length,this.vertexFormats=e,this.instanceFormats=t}t.prototype.createUniformBuffer=function(e,t){return void 0===t&&(t=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST),e=null!=e?e:new Float32Array(m(m([],x(this.resolution),!1),x(this.offset),!1)),this.createBuffer(this.bufferName+" Uniform Buffer",e,t)},t.prototype.createGeometryBuffer=function(e,t){return void 0===t&&(t=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST),this.createBuffer(this.bufferName+" Geometry Buffer",e,t)},t.prototype.createInstanceBuffer=function(e,t){return void 0===t&&(t=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST),this.createBuffer(this.bufferName+" Instance Buffer",e,t)},t.prototype.createVertexBuffer=function(e,t){return void 0===t&&(t=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST),this.createBuffer(this.bufferName+" Vertex Buffer",e,t)},t.prototype.createFrameBuffer=function(e,t){void 0===t&&(t=GPUBufferUsage.COPY_SRC|GPUBufferUsage.MAP_WRITE);e={name:this.bufferName+" Frame Buffer",size:e,usage:t,mappedAtCreation:!0},t=this.device.createBuffer(e);return t.unmap(),t},t.prototype.createBuffer=function(e,t,n){var r,e={label:e,size:t.byteLength+3&-4,usage:n,mappedAtCreation:!0},n=this.device.createBuffer(e);return t instanceof Uint16Array&&(r=new Uint16Array(n.getMappedRange())),t instanceof Uint32Array&&(r=new Uint32Array(n.getMappedRange())),(r=t instanceof Float32Array?new Float32Array(n.getMappedRange()):r).set(t),n.unmap(),n},t.prototype.getDevice=function(){return this.device},t.prototype.getBufferName=function(){return this.bufferName},t.prototype.getResolution=function(){return this.resolution},t.prototype.getOffset=function(){return this.offset},t.prototype.setDevice=function(e){this.device=e},t.prototype.setBufferName=function(e){this.bufferName=e},t.prototype.setResolution=function(e){return this.resolution!=(this.resolution=e)},t.prototype.setOffset=function(e){return this.offset!=(this.offset=e)};var _=t;function t(e,t,n,r){this.bufferName="Unknown",this.device=e||null,this.bufferName=t||"Unknown",this.resolution=n||[0,0],this.offset=r||[0,0]}c.startFrame=function(){c._queue=[],c._bundles=[]},c.render2=function(e,t,n,r,i,o,s,a){return c.render({device:e,pipeline:t,renderPassDescriptor:n,drawCounts:r,vertexBuffers:i,bindGroups:o,clip:s},a=void 0===a?!0:a)},c.render=function(e,t){void 0===t&&(t=!0);var n,r=e,e=r.device.createCommandEncoder(),i=e.beginRenderPass(r.renderPassDescriptor);i.setPipeline(r.pipeline);for(var o=0;o<r.vertexBuffers.length;o++)i.setVertexBuffer(o,r.vertexBuffers[o]);for(o=0;o<r.bindGroups.length;o++)i.setBindGroup(o,r.bindGroups[o]);if(r.drawCounts instanceof Array?i.draw(r.drawCounts[0],null!=(n=r.drawCounts[1])?n:1,null!=(n=r.drawCounts[2])?n:0,null!=(n=r.drawCounts[3])?n:0):i.draw(r.drawCounts.vertexCount,null!=(n=r.drawCounts.instanceCount)?n:1,null!=(n=r.drawCounts.firstVertex)?n:0,null!=(n=r.drawCounts.firstInstance)?n:0),i.end(),!t)return e.finish();r.device.queue.submit([e.finish()])},c.queue2=function(e,t,n,r,i,o,s){c.queue({device:e,pipeline:t,renderPassDescriptor:n,drawCounts:r,vertexBuffers:i,bindGroups:o,clip:s})},c.queue=function(e){null!=this._renderBatchInfo&&e.pipeline!==this._renderBatchInfo.pipeline&&this.submitRenderBatch(),c._queue.push(e)},c.queueRenderBatch=function(e){var t;(t=this._renderBatchQueue).push.apply(t,m([],x(e),!1))},c.bundle2=function(e,t,n,r,i){c.bundle(e,{pipeline:t,drawCounts:n,vertexBuffers:r,bindGroups:i})},c.bundle=function(e,t){var n=t,r=e.createRenderBundleEncoder({colorFormats:[c.colorFormat],depthStencilFormat:c.depthFormat});r.setPipeline(n.pipeline);for(var i=0,o=n.vertexBuffers.length;i<o;i++)r.setVertexBuffer(i,n.vertexBuffers[i]);for(var i=0,s=n.bindGroups.length;i<s;i++)r.setBindGroup(i,n.bindGroups[i]);n.drawCounts instanceof Array?r.draw(n.drawCounts[0],null!=(e=n.drawCounts[1])?e:1,null!=(e=n.drawCounts[2])?e:0,null!=(e=n.drawCounts[3])?e:0):r.draw(n.drawCounts.vertexCount,null!=(e=n.drawCounts.instanceCount)?e:1,null!=(e=n.drawCounts.firstVertex)?e:0,null!=(e=n.drawCounts.firstInstance)?e:0);e=r.finish();return e.label=t.pipeline.label+" Bundler",c._bundles.push(e),e},c.clearQueue=function(){c._queue=[]},c.clearBundles=function(){c._bundles=[]},c.setupRenderBatch=function(e,t,n,r,i,o,s,a){var u=this._renderBatchInfo;null!=this._renderBatchInfo&&u.pipeline===n||(this._renderBatchQueue=[],this._renderBatchInfo={device:e,vertexBufferManager:t,pipeline:n,renderPassDescriptor:r,clip:i,bindGroups:null!=o?o:[],geometryBuffer:s,geometryCount:a})},c.submitQueue=function(i){return V(this,void 0,void 0,function(){var t,n,r;return p(this,function(e){for(t=[],n=0;n<c._queue.length;n++)r=c._queue[n],i?t.push(c.render(r,!1)):c.render(r);return i&&0<t.length&&i.queue.submit(t),[2]})})},c.submitQueue2=function(s,a){var u,l;return V(this,void 0,void 0,function(){var t,n,r,i,o;return p(this,function(e){for(this.submitRenderBatch(a),t=s.createCommandEncoder(),n=0;n<c._queue.length;n++){for(r=c._queue[n],i=t.beginRenderPass(a),r.clip&&i.setScissorRect(r.clip[0],r.clip[1],r.clip[2],r.clip[3]),i.setPipeline(r.pipeline),o=0;o<r.vertexBuffers.length;o++)i.setVertexBuffer(o,r.vertexBuffers[o]);for(o=0;o<r.bindGroups.length;o++)i.setBindGroup(o,r.bindGroups[o]);r.drawCounts instanceof Array?i.draw(r.drawCounts[0],null!=(u=r.drawCounts[1])?u:1,null!=(u=r.drawCounts[2])?u:0,null!=(u=r.drawCounts[3])?u:0):i.draw(r.drawCounts.vertexCount,null!=(u=r.drawCounts.instanceCount)?u:1,null!=(l=r.drawCounts.firstVertex)?l:0,null!=(l=r.drawCounts.firstInstance)?l:0),i.end()}return s.queue.submit([t.finish()]),[2]})})},c.submitRenderBatch=function(e){var t,n;null!=this._renderBatchInfo&&0!=this._renderBatchQueue.length&&(t=this._renderBatchInfo.device,n=new _(t).createInstanceBuffer(Float32Array.from(this._renderBatchQueue)),null==this._renderBatchInfo.geometryBuffer?this.queue2(t,this._renderBatchInfo.pipeline,null!=e?e:this._renderBatchInfo.renderPassDescriptor,[6,this._renderBatchQueue.length/this._renderBatchInfo.vertexBufferManager.getInstanceLength()],[n],[]):this.queue2(t,this._renderBatchInfo.pipeline,null!=e?e:this._renderBatchInfo.renderPassDescriptor,[null!=(t=this._renderBatchInfo.geometryCount)?t:1,this._renderBatchQueue.length/this._renderBatchInfo.vertexBufferManager.getInstanceLength()],[this._renderBatchInfo.geometryBuffer,n],this._renderBatchInfo.bindGroups,this._renderBatchInfo.clip),this._renderBatchQueue=[],this._renderBatchInfo=null)},c.submitBundles=function(r,i){return V(this,void 0,void 0,function(){var t,n;return p(this,function(e){return r&&0<c._bundles.length&&(t=r.createCommandEncoder(),(n=t.beginRenderPass(i)).executeBundles(c._bundles),n.end(),r.queue.submit([t.finish()]),c._bundles=[]),[2]})})},c.createRenderPipeline=function(e,t,n,r,i,o){return t.createRenderPipeline({label:e+" Render Pipeline",layout:null!=o?o:"auto",vertex:{module:n,entryPoint:"main_vertex",buffers:i},fragment:{module:n,entryPoint:"main_fragment",targets:[{format:r,blend:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"},depthStencil:{format:"depth24plus",depthCompare:"less-equal",depthWriteEnabled:!0}})},c.createPipelineLayout=function(e,t,n){return t.createPipelineLayout({label:e+" Pipeline Layout",bindGroupLayouts:n})},c.createUniformBindGroupLayout=function(e,t){return t.createBindGroupLayout({label:e+" Uniform Bind Group Layout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX|GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]})},c.createUniformBindGroup=function(e,t,n,r,i){return t.createBindGroup({label:e+" Uniform Bind Group",layout:n.getBindGroupLayout(i=void 0===i?0:i),entries:[{binding:i,resource:{buffer:r}}]})},c.createBindGroup=function(e,t,n,r,i,o){void 0===o&&(o=0);for(var s=[],a=0;a<r.length;a++)s.push({binding:a,resource:{buffer:r[a]}});return t.createBindGroup({label:e+" Custom Bind Group",layout:null!=i?i:n.getBindGroupLayout(o),entries:s})},c.createBindGroupLayout=function(e,t,n){for(var r=[],i=0;i<n.length;i++)r.push({binding:i,visibility:n[i].visibility,buffer:n[i].buffer});return t.createBindGroupLayout({label:e+" Custom Bind Group Layout",entries:r})},c.createRenderPassDescriptor=function(e,t,n){return{label:e+" Render Pass Descriptor",colorAttachments:[{view:void 0,clearValue:t,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:n,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}}},c._queue=[],c._bundles=[],c.colorFormat="bgra8unorm",c.depthFormat="depth24plus",c._renderBatchQueue=[],c._renderBatchInfo=null;var w=c;function c(){}function q(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var F={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},N=/([astvzqmhlc])([^astvzqmhlc]*)/gi;var G=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;var z=q(function(e){var i=[];return e.replace(N,function(e,t,n){var r=t.toLowerCase();for(n=function(e){e=e.match(G);return e?e.map(Number):[]}(n),"m"==r&&2<n.length&&(i.push([t].concat(n.splice(0,2))),r="l",t="m"==t?"l":"L");;){if(n.length==F[r])return n.unshift(t),i.push(n);if(n.length<F[r])throw new Error("malformed path data");i.push([t].concat(n.splice(0,F[r])))}}),i}),n={exports:{}};var H=function(e,t){if(e.length<=1)return e;for(var n,r,i,o,s=(t="number"==typeof t?t:1)*t,a=e[0],u=[a],l=1,c=e.length;l<c;l++)n=e[l],i=a,o=void 0,o=(r=n)[0]-i[0],r=r[1]-i[1],s<o*o+r*r&&(u.push(n),a=n);return a!==n&&u.push(n),u},W=function(e,t){var n;return e.length<=1?e:(function e(t,n,r,i,o){for(var s,a,u,l,c,f,h,d=i,p=n+1;p<r;p++){a=t[p],u=t[n],v=t[r],h=f=c=l=void 0,c=u[0],u=u[1],f=v[0]-c,h=v[1]-u,0==f&&0==h||(1<(l=((a[0]-c)*f+(a[1]-u)*h)/(f*f+h*h))?(c=v[0],u=v[1]):0<l&&(c+=f*l,u+=h*l));var v=(f=a[0]-c)*f+(h=a[1]-u)*h;d<v&&(s=p,d=v)}i<d&&(1<s-n&&e(t,n,s,i,o),o.push(t[s]),1<r-s)&&e(t,s,r,i,o)}(e,0,n=e.length-1,(t="number"==typeof t?t:1)*t,t=[e[0]]),t.push(e[n]),t)};n.exports=function(e,t){return e=H(e,t),e=W(e,t)},n.exports.radialDistance=H,n.exports.douglasPeucker=W;var $=q(n.exports);function Y(e){return[e[0],e[1]]}function j(e,t,n,r,i,o){var s,a,u,l,c,f,i=X/(i="number"==typeof i?i:1);return t=t,n=n,r=r,i=i*=i,(s=o=o||[]).push(Y(e=e)),a=e[0],e=e[1],u=t[0],t=t[1],l=n[0],n=n[1],c=r[0],f=r[1],function e(t,n,r,i,o,s,a,u,l,c,f){if(Q<f)return;var h=Math.PI;var d=(t+r)/2;var p=(n+i)/2;var v=(r+o)/2;var g=(i+s)/2;var x=(o+a)/2;var m=(s+u)/2;var y=(d+v)/2;var _=(p+g)/2;v=(v+x)/2;g=(g+m)/2;var w=(y+v)/2;var b=(_+g)/2;if(0<f){var O,E=a-t,L=u-n,S=Math.abs((r-a)*L-(i-u)*E),k=Math.abs((o-a)*L-(s-u)*E);if(Z<S&&Z<k){if((S+k)*(S+k)<=c*(E*E+L*L)){if(R<J)return void l.push([w,b]);var C=Math.atan2(s-i,o-r);if(O=Math.abs(C-Math.atan2(i-n,r-t)),C=Math.abs(Math.atan2(u-s,a-o)-C),(O=h<=O?2*h-O:O)+(C=h<=C?2*h-C:C)<R)return void l.push([w,b]);if(0!==B){if(B<O)return void l.push([r,i]);if(B<C)return void l.push([o,s])}}}else if(Z<S){if(S*S<=c*(E*E+L*L)){if(R<J)return void l.push([w,b]);if(O=Math.abs(Math.atan2(s-i,o-r)-Math.atan2(i-n,r-t)),(O=h<=O?2*h-O:O)<R)return l.push([r,i]),void l.push([o,s]);if(0!==B&&B<O)return void l.push([r,i])}}else if(Z<k){if(k*k<=c*(E*E+L*L)){if(R<J)return void l.push([w,b]);if(O=Math.abs(Math.atan2(u-s,a-o)-Math.atan2(s-i,o-r)),(O=h<=O?2*h-O:O)<R)return l.push([r,i]),void l.push([o,s]);if(0!==B&&B<O)return void l.push([o,s])}}else if((E=w-(t+a)/2)*E+(L=b-(n+u)/2)*L<=c)return void l.push([w,b])}e(t,n,d,p,y,_,w,b,l,c,f+1);e(w,b,v,g,x,m,a,u,l,c,f+1)}(a,e,u,t,l,n,c,f,s,i,0),s.push(Y(r)),o}var Q,Z,X,J,R,B;Q="number"==typeof(o=o||{}).recursion?o.recursion:8,Z="number"==typeof o.epsilon?o.epsilon:1.1920929e-7,X="number"==typeof o.pathEpsilon?o.pathEpsilon:1,J="number"==typeof o.angleEpsilon?o.angleEpsilon:.01,R=o.angleTolerance||0,B=o.cuspLimit||0;var O=Math.PI,K=re(120);function ee(e,t,n,r){return["C",e,t,n,r,n,r]}function te(e,t,n,r,i,o){return["C",e/3+2/3*n,t/3+2/3*r,i/3+2/3*n,o/3+2/3*r,i,o]}function ne(e,t,n){return{x:e*Math.cos(n)-t*Math.sin(n),y:e*Math.sin(n)+t*Math.cos(n)}}function re(e){return e*(O/180)}var ie=j,oe=function(e){var i=0,o=0,s=0,a=0;return e.map(function(e){var t=(e=e.slice())[0],n=t.toUpperCase();if(t!=n)switch(e[0]=n,t){case"a":e[6]+=s,e[7]+=a;break;case"v":e[1]+=a;break;case"h":e[1]+=s;break;default:for(var r=1;r<e.length;)e[r++]+=s,e[r++]+=a}switch(n){case"Z":s=i,a=o;break;case"H":s=e[1];break;case"V":a=e[1];break;case"M":s=i=e[1],a=o=e[2];break;default:s=e[e.length-2],a=e[e.length-1]}return e})},se=function(e){for(var t,n=[],r=0,i=0,o=0,s=0,a=null,u=null,l=0,c=0,f=0,h=e.length;f<h;f++){var d=e[f],p=d[0];switch(p){case"M":o=d[1],s=d[2];break;case"A":(d=function e(t,n,r,i,o,s,a,u,l,c){{var f,h,d,p;c?(d=c[0],p=c[1],f=c[2],h=c[3]):(y=ne(t,n,-o),t=y.x,n=y.y,y=ne(u,l,-o),u=y.x,l=y.y,1<(v=(y=(t-u)/2)*y/(r*r)+(x=(n-l)/2)*x/(i*i))&&(v=Math.sqrt(v),r*=v,i*=v),v=r*r,g=i*i,s=(s==a?-1:1)*Math.sqrt(Math.abs((v*g-v*x*x-g*y*y)/(v*x*x+g*y*y))),f=(s=s==1/0?1:s)*r*x/i+(t+u)/2,h=s*-i*y/r+(n+l)/2,d=Math.asin(((n-h)/i).toFixed(9)),p=Math.asin(((l-h)/i).toFixed(9)),(d=t<f?O-d:d)<0&&(d=2*O+d),(p=u<f?O-p:p)<0&&(p=2*O+p),a&&p<d&&(d-=2*O),!a&&d<p&&(p-=2*O))}{var v,g,x,m;Math.abs(p-d)>K&&(v=p,g=u,x=l,p=d+K*(a&&d<p?1:-1),u=f+r*Math.cos(p),l=h+i*Math.sin(p),m=e(u,l,r,i,o,0,a,g,x,[p,v,f,h]))}s=Math.tan((p-d)/4);var y=4/3*r*s;a=4/3*i*s;var _=[2*t-(t+y*Math.sin(d)),2*n-(n-a*Math.cos(d)),u+y*Math.sin(p),l-a*Math.cos(p),u,l];if(c)return _;m&&(_=_.concat(m));for(var w=0;w<_.length;){var b=ne(_[w],_[w+1],o);_[w++]=b.x,_[w++]=b.y}return _}(l,c,d[1],d[2],re(d[3]),d[4],d[5],d[6],d[7])).unshift("C"),7<d.length&&(n.push(d.splice(0,7)),d.unshift("C"));break;case"S":var v=l,g=c;"C"!=t&&"S"!=t||(v+=v-r,g+=g-i),d=["C",v,g,d[1],d[2],d[3],d[4]];break;case"T":u="Q"==t||"T"==t?(a=2*l-a,2*c-u):(a=l,c),d=te(l,c,a,u,d[1],d[2]);break;case"Q":a=d[1],u=d[2],d=te(l,c,d[1],d[2],d[3],d[4]);break;case"L":d=ee(l,c,d[1],d[2]);break;case"H":d=ee(l,c,d[1],c);break;case"V":d=ee(l,c,l,d[1]);break;case"Z":d=ee(l,c,o,s)}t=p,l=d[d.length-2],c=d[d.length-1],i=4<d.length?(r=d[d.length-4],d[d.length-3]):(r=l,c),n.push(d)}return n},ae=function(e,t){return e[0]=t[0],e[1]=t[1],e};function ue(e,t,n){return e[0]=t,e[1]=n,e}var le=[0,0],ce=[0,0],fe=[0,0];function v(e){if(!e)throw"Assertion Failed!"}var he=q(function(e,s){var a=[],u=[],l=[0,0];return se(oe(e)).forEach(function(e,t,n){if("M"===e[0])ae(l,e.slice(1)),0<u.length&&(a.push(u),u=[]);else{if("C"!==e[0])throw new Error("illegal type in SVG: "+e[0]);r=u,i=s,ie(l,ue(le,(o=e)[1],o[2]),ue(ce,o[3],o[4]),ue(fe,o[5],o[6]),i,r),ue(l,e[5],e[6])}var r,i,o}),0<u.length&&a.push(u),a}),g={},n=g;g.WINDING_ODD=0,g.WINDING_NONZERO=1,g.WINDING_POSITIVE=2,g.WINDING_NEGATIVE=3,g.WINDING_ABS_GEQ_TWO=4,g.POLYGONS=0,g.CONNECTED_POLYGONS=1,g.BOUNDARY_CONTOURS=2,g.tesselate=function(e){for(var t=e.debug||!1,n=new be,r=0;r<e.contours.length;r++)n.addContour(e.vertexSize||2,e.contours[r]);return n.tesselate(e.windingRule||g.WINDING_ODD,e.elementType||g.POLYGONS,e.polySize||3,e.vertexSize||2,e.normal||[0,0,1]),{vertices:n.vertices,vertexIndices:n.vertexIndices,vertexCount:n.vertexCount,elements:n.elements,elementCount:n.elementCount,mesh:t?n.mesh:void 0}};function f(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}function de(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}function pe(e){this.next=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Org=null,this.Lface=null,this.activeRegion=null,this.winding=0,this.side=e}function ve(){var e=new f,t=new de,n=new pe(0),r=new pe(1);(e.next=e.prev=e).anEdge=null,(t.next=t.prev=t).anEdge=null,t.trail=null,t.marked=!1,t.inside=!1,(n.next=n).Sym=r,n.Onext=null,n.Lnext=null,n.Org=null,n.Lface=null,n.winding=0,n.activeRegion=null,(r.next=r).Sym=n,r.Onext=null,r.Lnext=null,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,this.vHead=e,this.fHead=t,this.eHead=n,this.eHeadSym=r}pe.prototype={get Rface(){return this.Sym.Lface},set Rface(e){this.Sym.Lface=e},get Dst(){return this.Sym.Org},set Dst(e){this.Sym.Org=e},get Oprev(){return this.Sym.Lnext},set Oprev(e){this.Sym.Lnext=e},get Lprev(){return this.Onext.Sym},set Lprev(e){this.Onext.Sym=e},get Dprev(){return this.Lnext.Sym},set Dprev(e){this.Lnext.Sym=e},get Rprev(){return this.Sym.Onext},set Rprev(e){this.Sym.Onext=e},get Dnext(){return this.Sym.Onext.Sym},set Dnext(e){this.Sym.Onext.Sym=e},get Rnext(){return this.Sym.Lnext.Sym},set Rnext(e){this.Sym.Lnext.Sym=e}},ve.prototype={makeEdge_:function(e){var t=new pe(0),n=new pe(1),r=(e=e.Sym.side<e.side?e.Sym:e).Sym.next;return(((n.next=r).Sym.next=t).next=e).Sym.next=n,t.Sym=n,(t.Onext=t).Lnext=n,t.Org=null,t.Lface=null,t.winding=0,t.activeRegion=null,n.Sym=t,(n.Onext=n).Lnext=t,n.Org=null,n.Lface=null,n.winding=0,n.activeRegion=null,t},splice_:function(e,t){var n=e.Onext,r=t.Onext;n.Sym.Lnext=t,(r.Sym.Lnext=e).Onext=r,t.Onext=n},makeVertex_:function(e,t,n){for(var r=e,e=(v(null!==r),n.prev),i=((((r.prev=e).next=r).next=n).prev=r).anEdge=t;i.Org=r,(i=i.Onext)!==t;);},makeFace_:function(e,t,n){for(var r=e,e=(v(null!==r),n.prev),i=(((((r.prev=e).next=r).next=n).prev=r).anEdge=t,r.trail=null,r.marked=!1,r.inside=n.inside,t);i.Lface=r,(i=i.Lnext)!==t;);},killEdge_:function(e){var t=(e=e.Sym.side<e.side?e.Sym:e).next,e=e.Sym.next;(t.Sym.next=e).Sym.next=t},killVertex_:function(e,t){for(var n=e.anEdge,r=n;r.Org=t,(r=r.Onext)!==n;);var i=e.prev,e=e.next;(e.prev=i).next=e},killFace_:function(e,t){for(var n=e.anEdge,r=n;r.Lface=t,(r=r.Lnext)!==n;);var i=e.prev,e=e.next;(e.prev=i).next=e},makeEdge:function(){var e=new f,t=new f,n=new de,r=this.makeEdge_(this.eHead);return this.makeVertex_(e,r,this.vHead),this.makeVertex_(t,r.Sym,this.vHead),this.makeFace_(n,r,this.fHead),r},splice:function(e,t){var n=!1,r=!1;e===t||(t.Org!==e.Org&&(r=!0,this.killVertex_(t.Org,e.Org)),t.Lface!==e.Lface&&(n=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(t,e),r||(r=new f,this.makeVertex_(r,t,e.Org),e.Org.anEdge=e),n)||(r=new de,this.makeFace_(r,t,e.Lface),e.Lface.anEdge=e)},delete:function(e){var t=e.Sym,n=!1;e.Lface!==e.Rface&&(n=!0,this.killFace_(e.Lface,e.Rface)),e.Onext===e?this.killVertex_(e.Org,null):(e.Rface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev),n||(n=new de,this.makeFace_(n,e,e.Lface))),t.Onext===t?(this.killVertex_(t.Org,null),this.killFace_(t.Lface,null)):(e.Lface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),this.killEdge_(e)},addEdgeVertex:function(e){var t=this.makeEdge_(e),n=t.Sym,r=(this.splice_(t,e.Lnext),t.Org=e.Dst,new f);return this.makeVertex_(r,n,t.Org),t.Lface=n.Lface=e.Lface,t},splitEdge:function(e,t){var n=this.addEdgeVertex(e).Sym;return this.splice_(e.Sym,e.Sym.Oprev),this.splice_(e.Sym,n),e.Dst=n.Org,n.Dst.anEdge=n.Sym,n.Rface=e.Rface,n.winding=e.winding,n.Sym.winding=e.Sym.winding,n},connect:function(e,t){var n=!1,r=this.makeEdge_(e),i=r.Sym;return t.Lface!==e.Lface&&(n=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(r,e.Lnext),this.splice_(i,t),r.Org=e.Dst,i.Org=t.Org,r.Lface=i.Lface=e.Lface,e.Lface.anEdge=i,n||(t=new de,this.makeFace_(t,r,e.Lface)),r},zapFace:function(e){for(var t,n,r,i=e.anEdge,o=i.Lnext;o=(t=o).Lnext,(t.Lface=null)===t.Rface&&(t.Onext===t?this.killVertex_(t.Org,null):(t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),(n=t.Sym).Onext===n?this.killVertex_(n.Org,null):(n.Org.anEdge=n.Onext,this.splice_(n,n.Oprev)),this.killEdge_(t)),t!=i;);r=e.prev,((e=e.next).prev=r).next=e},countFaceVerts_:function(e){for(var t=e.anEdge,n=0;n++,(t=t.Lnext)!==e.anEdge;);return n},mergeConvexFaces:function(e){for(var t,n,r,i,o=this.fHead.next;o!==this.fHead;o=o.next)if(o.inside)for(i=(t=o.anEdge).Org;;){if(n=t.Lnext,(r=t.Sym)&&r.Lface&&r.Lface.inside&&this.countFaceVerts_(o)+this.countFaceVerts_(r.Lface)-2<=e&&h.vertCCW(t.Lprev.Org,t.Org,r.Lnext.Lnext.Org)&&h.vertCCW(r.Lprev.Org,r.Org,t.Lnext.Lnext.Org)&&(n=r.Lnext,this.delete(r),t=null),t&&t.Lnext.Org===i)break;t=n}return!0},check:function(){var e,t,n,r,i,o=this.fHead,s=this.vHead,a=this.eHead,u=o;for(u=o;(e=u.next)!==o;u=e)for(v(e.prev===u),r=e.anEdge;v(r.Sym!==r),v(r.Sym.Sym===r),v(r.Lnext.Onext.Sym===r),v(r.Onext.Sym.Lnext===r),v(r.Lface===e),(r=r.Lnext)!==e.anEdge;);for(v(e.prev===u&&null===e.anEdge),n=n=s;(t=n.next)!==s;n=t)for(v(t.prev===n),r=t.anEdge;v(r.Sym!==r),v(r.Sym.Sym===r),v(r.Lnext.Onext.Sym===r),v(r.Onext.Sym.Lnext===r),v(r.Org===t),(r=r.Onext)!==t.anEdge;);for(v(t.prev===n&&null===t.anEdge),i=i=a;(r=i.next)!==a;i=r)v(r.Sym.next===i.Sym),v(r.Sym!==r),v(r.Sym.Sym===r),v(null!==r.Org),v(null!==r.Dst),v(r.Lnext.Onext.Sym===r),v(r.Onext.Sym.Lnext===r);v(r.Sym.next===i.Sym&&r.Sym===this.eHeadSym&&r.Sym.Sym===r&&null===r.Org&&null===r.Dst&&null===r.Lface&&null===r.Rface)}};var h={};function ge(){this.key=null,this.next=null,this.prev=null}function xe(e,t){this.head=new ge,this.head.next=this.head,this.head.prev=this.head,this.frame=e,this.leq=t}function me(){this.handle=null}function ye(){this.key=null,this.node=null}function _e(e,t){this.size=0,this.max=e,this.nodes=[],this.nodes.length=e+1;for(var n=0;n<this.nodes.length;n++)this.nodes[n]=new me;this.handles=[],this.handles.length=e+1;for(n=0;n<this.handles.length;n++)this.handles[n]=new ye;this.initialized=!1,this.freeList=0,this.leq=t,this.nodes[1].handle=1,this.handles[1].key=null}function we(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}h.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},h.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},h.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},h.edgeGoesLeft=function(e){return h.vertLeq(e.Dst,e.Org)},h.edgeGoesRight=function(e){return h.vertLeq(e.Org,e.Dst)},h.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},h.edgeEval=function(e,t,n){v(h.vertLeq(e,t)&&h.vertLeq(t,n));var r=t.s-e.s,i=n.s-t.s;return 0<r+i?r<i?t.t-e.t+(e.t-n.t)*(r/(r+i)):t.t-n.t+(n.t-e.t)*(i/(r+i)):0},h.edgeSign=function(e,t,n){v(h.vertLeq(e,t)&&h.vertLeq(t,n));var r=t.s-e.s,i=n.s-t.s;return 0<r+i?(t.t-n.t)*r+(t.t-e.t)*i:0},h.transEval=function(e,t,n){v(h.transLeq(e,t)&&h.transLeq(t,n));var r=t.t-e.t,i=n.t-t.t;return 0<r+i?r<i?t.s-e.s+(e.s-n.s)*(r/(r+i)):t.s-n.s+(n.s-e.s)*(i/(r+i)):0},h.transSign=function(e,t,n){v(h.transLeq(e,t)&&h.transLeq(t,n));var r=t.t-e.t,i=n.t-t.t;return 0<r+i?(t.s-n.s)*r+(t.s-e.s)*i:0},h.vertCCW=function(e,t,n){return 0<=e.s*(t.t-n.t)+t.s*(n.t-e.t)+n.s*(e.t-t.t)},h.interpolate=function(e,t,n,r){return(e=e<0?0:e)<=(n=n<0?0:n)?0==n?(t+r)/2:t+e/(e+n)*(r-t):r+n/(e+n)*(t-r)},h.intersect=function(e,t,n,r,i){var o,s,a;h.vertLeq(e,t)||(a=e,e=t,t=a),h.vertLeq(n,r)||(a=n,n=r,r=a),h.vertLeq(e,n)||(a=e,e=n,n=a,a=t,t=r,r=a),h.vertLeq(n,t)?h.vertLeq(t,r)?((o=h.edgeEval(e,n,t))+(s=h.edgeEval(n,t,r))<0&&(o=-o,s=-s),i.s=h.interpolate(o,n.s,s,t.s)):((o=h.edgeSign(e,n,t))+(s=-h.edgeSign(e,r,t))<0&&(o=-o,s=-s),i.s=h.interpolate(o,n.s,s,r.s)):i.s=(n.s+t.s)/2,h.transLeq(e,t)||(a=e,e=t,t=a),h.transLeq(n,r)||(a=n,n=r,r=a),h.transLeq(e,n)||(a=e,e=n,n=a,a=t,t=r,r=a),h.transLeq(n,t)?h.transLeq(t,r)?((o=h.transEval(e,n,t))+(s=h.transEval(n,t,r))<0&&(o=-o,s=-s),i.t=h.interpolate(o,n.t,s,t.t)):((o=h.transSign(e,n,t))+(s=-h.transSign(e,r,t))<0&&(o=-o,s=-s),i.t=h.interpolate(o,n.t,s,r.t)):i.t=(n.t+t.t)/2},xe.prototype={min:function(){return this.head.next},max:function(){return this.head.prev},insert:function(e){return this.insertBefore(this.head,e)},search:function(e){for(var t=this.head;null!==(t=t.next).key&&!this.leq(this.frame,e,t.key););return t},insertBefore:function(e,t){for(;null!==(e=e.prev).key&&!this.leq(this.frame,e.key,t););var n=new ge;return n.key=t,n.next=e.next,((e.next.prev=n).prev=e).next=n},delete:function(e){e.next.prev=e.prev,e.prev.next=e.next}},_e.prototype={floatDown_:function(e){for(var t,n,r=this.nodes,i=this.handles,o=r[e].handle;;){if((n=e<<1)<this.size&&this.leq(i[r[n+1].handle].key,i[r[n].handle].key)&&++n,v(n<=this.max),t=r[n].handle,n>this.size||this.leq(i[o].key,i[t].key)){i[r[e].handle=o].node=e;break}i[r[e].handle=t].node=e,e=n}},floatUp_:function(e){for(var t,n,r=this.nodes,i=this.handles,o=r[e].handle;;){if(t=r[n=e>>1].handle,0==n||this.leq(i[t].key,i[o].key)){i[r[e].handle=o].node=e;break}i[r[e].handle=t].node=e,e=n}},init:function(){for(var e=this.size;1<=e;--e)this.floatDown_(e);this.initialized=!0},min:function(){return this.handles[this.nodes[1].handle].key},isEmpty:function(){this.size},insert:function(e){var t,n,r=++this.size;if(2*r>this.max){this.max*=2,n=this.nodes.length,this.nodes.length=this.max+1;for(var i=n;i<this.nodes.length;i++)this.nodes[i]=new me;n=this.handles.length,this.handles.length=this.max+1;for(i=n;i<this.handles.length;i++)this.handles[i]=new ye}return 0===this.freeList?t=r:(t=this.freeList,this.freeList=this.handles[t].node),this.nodes[r].handle=t,this.handles[t].node=r,this.handles[t].key=e,this.initialized&&this.floatUp_(r),t},extractMin:function(){var e=this.nodes,t=this.handles,n=e[1].handle,r=t[n].key;return 0<this.size&&(e[1].handle=e[this.size].handle,t[e[1].handle].node=1,t[n].key=null,t[n].node=this.freeList,this.freeList=n,--this.size,0<this.size)&&this.floatDown_(1),r},delete:function(e){var t,n=this.nodes,r=this.handles;v(1<=e&&e<=this.max&&null!==r[e].key),n[t=r[e].node].handle=n[this.size].handle,r[n[t].handle].node=t,--this.size,t<=this.size&&(t<=1||this.leq(r[n[t>>1].handle].key,r[n[t].handle].key)?this.floatDown_(t):this.floatUp_(t)),r[e].key=null,r[e].node=this.freeList,this.freeList=e}};var b={};function be(){this.mesh=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=g.WINDING_ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}b.regionBelow=function(e){return e.nodeUp.prev.key},b.regionAbove=function(e){return e.nodeUp.next.key},b.debugEvent=function(e){},b.addWinding=function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},b.edgeLeq=function(e,t,n){var e=e.event,t=t.eUp,n=n.eUp;return t.Dst===e?n.Dst===e?h.vertLeq(t.Org,n.Org)?h.edgeSign(n.Dst,t.Org,n.Org)<=0:0<=h.edgeSign(t.Dst,n.Org,t.Org):h.edgeSign(n.Dst,e,n.Org)<=0:n.Dst===e?0<=h.edgeSign(t.Dst,e,t.Org):(t=h.edgeEval(t.Dst,e,t.Org),h.edgeEval(n.Dst,e,n.Org)<=t)},b.deleteRegion=function(e,t){t.fixUpperEdge&&v(0===t.eUp.winding),t.eUp.activeRegion=null,e.dict.delete(t.nodeUp)},b.fixUpperEdge=function(e,t,n){v(t.fixUpperEdge),e.mesh.delete(t.eUp),t.fixUpperEdge=!1,(t.eUp=n).activeRegion=t},b.topLeftRegion=function(e,t){for(var n,r=t.eUp.Org;(t=b.regionAbove(t)).eUp.Org===r;);if(t.fixUpperEdge){if(null===(n=e.mesh.connect(b.regionBelow(t).eUp.Sym,t.eUp.Lnext)))return null;b.fixUpperEdge(e,t,n),t=b.regionAbove(t)}return t},b.topRightRegion=function(e){for(var t=e.eUp.Dst,e=null;(e=b.regionAbove(e)).eUp.Dst===t;);return e},b.addRegionBelow=function(e,t,n){var r=new we;return r.eUp=n,r.nodeUp=e.dict.insertBefore(t.nodeUp,r),r.fixUpperEdge=!1,r.sentinel=!1,r.dirty=!1,n.activeRegion=r},b.isWindingInside=function(e,t){switch(e.windingRule){case g.WINDING_ODD:return 0!=(1&t);case g.WINDING_NONZERO:return 0!=t;case g.WINDING_POSITIVE:return 0<t;case g.WINDING_NEGATIVE:return t<0;case g.WINDING_ABS_GEQ_TWO:return 2<=t||t<=-2}return v(!1),!1},b.computeWinding=function(e,t){t.windingNumber=b.regionAbove(t).windingNumber+t.eUp.winding,t.inside=b.isWindingInside(e,t.windingNumber)},b.finishRegion=function(e,t){var n=t.eUp,r=n.Lface;r.inside=t.inside,r.anEdge=n,b.deleteRegion(e,t)},b.finishLeftRegions=function(e,t,n){for(var r,i,o=t,s=t.eUp;o!==n;){if(o.fixUpperEdge=!1,(r=(i=b.regionBelow(o)).eUp).Org!=s.Org){if(!i.fixUpperEdge){b.finishRegion(e,o);break}r=e.mesh.connect(s.Lprev,r.Sym),b.fixUpperEdge(e,i,r)}s.Onext!==r&&(e.mesh.splice(r.Oprev,r),e.mesh.splice(s,r)),b.finishRegion(e,o),s=i.eUp,o=i}return s},b.addRightEdges=function(e,t,n,r,i,o){for(var s,a,u,l=!0,c=n;v(h.vertLeq(c.Org,c.Dst)),b.addRegionBelow(e,t,c.Sym),(c=c.Onext)!==r;);for(a=t,u=i=null===i?b.regionBelow(t).eUp.Rprev:i;(c=(s=b.regionBelow(a)).eUp.Sym).Org===u.Org;)c.Onext!==u&&(e.mesh.splice(c.Oprev,c),e.mesh.splice(u.Oprev,c)),s.windingNumber=a.windingNumber-c.winding,s.inside=b.isWindingInside(e,s.windingNumber),a.dirty=!0,!l&&b.checkForRightSplice(e,a)&&(b.addWinding(c,u),b.deleteRegion(e,a),e.mesh.delete(u)),l=!1,a=s,u=c;a.dirty=!0,v(a.windingNumber-c.winding===s.windingNumber),o&&b.walkDirtyRegions(e,a)},b.spliceMergeVertices=function(e,t,n){e.mesh.splice(t,n)},b.vertexWeights=function(e,t,n){var r=h.vertL1dist(t,e),i=h.vertL1dist(n,e),o=.5*i/(r+i),r=.5*r/(r+i);e.coords[0]+=o*t.coords[0]+r*n.coords[0],e.coords[1]+=o*t.coords[1]+r*n.coords[1],e.coords[2]+=o*t.coords[2]+r*n.coords[2]},b.getIntersectData=function(e,t,n,r,i,o){t.coords[0]=t.coords[1]=t.coords[2]=0,t.idx=-1,b.vertexWeights(t,n,r),b.vertexWeights(t,i,o)},b.checkForRightSplice=function(e,t){var n=b.regionBelow(t),r=t.eUp,i=n.eUp;if(h.vertLeq(r.Org,i.Org)){if(0<h.edgeSign(i.Dst,r.Org,i.Org))return!1;h.vertEq(r.Org,i.Org)?r.Org!==i.Org&&(e.pq.delete(r.Org.pqHandle),b.spliceMergeVertices(e,i.Oprev,r)):(e.mesh.splitEdge(i.Sym),e.mesh.splice(r,i.Oprev),t.dirty=n.dirty=!0)}else{if(h.edgeSign(r.Dst,i.Org,r.Org)<0)return!1;b.regionAbove(t).dirty=t.dirty=!0,e.mesh.splitEdge(r.Sym),e.mesh.splice(i.Oprev,r)}return!0},b.checkForLeftSplice=function(e,t){var n,r=b.regionBelow(t),i=t.eUp,o=r.eUp;if(v(!h.vertEq(i.Dst,o.Dst)),h.vertLeq(i.Dst,o.Dst)){if(h.edgeSign(i.Dst,o.Dst,i.Org)<0)return!1;b.regionAbove(t).dirty=t.dirty=!0,n=e.mesh.splitEdge(i),e.mesh.splice(o.Sym,n),n.Lface.inside=t.inside}else{if(0<h.edgeSign(o.Dst,i.Dst,o.Org))return!1;t.dirty=r.dirty=!0,n=e.mesh.splitEdge(o),e.mesh.splice(i.Lnext,o.Sym),n.Rface.inside=t.inside}return!0},b.checkForIntersect=function(e,t){var n,r=b.regionBelow(t),i=t.eUp,o=r.eUp,s=i.Org,a=o.Org,u=i.Dst,l=o.Dst,c=new f;if(v(!h.vertEq(l,u)),v(h.edgeSign(u,e.event,s)<=0),v(0<=h.edgeSign(l,e.event,a)),v(s!==e.event&&a!==e.event),v(!t.fixUpperEdge&&!r.fixUpperEdge),s!==a&&(n=Math.min(s.t,u.t),!(Math.max(a.t,l.t)<n))){if(h.vertLeq(s,a)){if(0<h.edgeSign(l,s,a))return!1}else if(h.edgeSign(u,a,s)<0)return!1;if(b.debugEvent(e),h.intersect(u,s,l,a,c),v(Math.min(s.t,u.t)<=c.t),v(c.t<=Math.max(a.t,l.t)),v(Math.min(l.s,u.s)<=c.s),v(c.s<=Math.max(a.s,s.s)),h.vertLeq(c,e.event)&&(c.s=e.event.s,c.t=e.event.t),n=h.vertLeq(s,a)?s:a,h.vertLeq(n,c)&&(c.s=n.s,c.t=n.t),h.vertEq(c,s)||h.vertEq(c,a))b.checkForRightSplice(e,t);else{if(!h.vertEq(u,e.event)&&0<=h.edgeSign(u,e.event,c)||!h.vertEq(l,e.event)&&h.edgeSign(l,e.event,c)<=0)return l===e.event?(e.mesh.splitEdge(i.Sym),e.mesh.splice(o.Sym,i),t=b.topLeftRegion(e,t),i=b.regionBelow(t).eUp,b.finishLeftRegions(e,b.regionBelow(t),r),b.addRightEdges(e,t,i.Oprev,i,i,!0),TRUE):u===e.event?(e.mesh.splitEdge(o.Sym),e.mesh.splice(i.Lnext,o.Oprev),r=t,t=b.topRightRegion(t),n=b.regionBelow(t).eUp.Rprev,r.eUp=o.Oprev,o=b.finishLeftRegions(e,r,null),b.addRightEdges(e,t,o.Onext,i.Rprev,n,!0),!0):(0<=h.edgeSign(u,e.event,c)&&(b.regionAbove(t).dirty=t.dirty=!0,e.mesh.splitEdge(i.Sym),i.Org.s=e.event.s,i.Org.t=e.event.t),h.edgeSign(l,e.event,c)<=0&&(t.dirty=r.dirty=!0,e.mesh.splitEdge(o.Sym),o.Org.s=e.event.s,o.Org.t=e.event.t),!1);e.mesh.splitEdge(i.Sym),e.mesh.splitEdge(o.Sym),e.mesh.splice(o.Oprev,i),i.Org.s=c.s,i.Org.t=c.t,i.Org.pqHandle=e.pq.insert(i.Org),b.getIntersectData(e,i.Org,s,u,a,l),b.regionAbove(t).dirty=t.dirty=r.dirty=!0}}return!1},b.walkDirtyRegions=function(e,t){for(var n,r,i=b.regionBelow(t);;){for(;i.dirty;)t=i,i=b.regionBelow(i);if(!t.dirty&&(i=t,null==(t=b.regionAbove(t))||!t.dirty))return;if(t.dirty=!1,n=t.eUp,r=i.eUp,n.Dst!==r.Dst&&b.checkForLeftSplice(e,t)&&(i.fixUpperEdge?(b.deleteRegion(e,i),e.mesh.delete(r),r=(i=b.regionBelow(t)).eUp):t.fixUpperEdge&&(b.deleteRegion(e,t),e.mesh.delete(n),n=(t=b.regionAbove(i)).eUp)),n.Org!==r.Org)if(n.Dst===r.Dst||t.fixUpperEdge||i.fixUpperEdge||n.Dst!==e.event&&r.Dst!==e.event)b.checkForRightSplice(e,t);else if(b.checkForIntersect(e,t))return;n.Org===r.Org&&n.Dst===r.Dst&&(b.addWinding(r,n),b.deleteRegion(e,t),e.mesh.delete(n),t=b.regionAbove(i))}},b.connectRightVertex=function(e,t,n){var r=n.Onext,i=b.regionBelow(t),o=t.eUp,s=i.eUp,a=!1;o.Dst!==s.Dst&&b.checkForIntersect(e,t),h.vertEq(o.Org,e.event)&&(e.mesh.splice(r.Oprev,o),t=b.topLeftRegion(e,t),r=b.regionBelow(t).eUp,b.finishLeftRegions(e,b.regionBelow(t),i),a=!0),h.vertEq(s.Org,e.event)&&(e.mesh.splice(n,s.Oprev),n=b.finishLeftRegions(e,i,null),a=!0),a?b.addRightEdges(e,t,n.Onext,r,r,!0):(i=h.vertLeq(s.Org,o.Org)?s.Oprev:o,i=e.mesh.connect(n.Lprev,i),b.addRightEdges(e,t,i,i.Onext,i.Onext,!1),i.Sym.activeRegion.fixUpperEdge=!0,b.walkDirtyRegions(e,t))},b.connectLeftDegenerate=function(e,t,n){var r,i,o,s,a=t.eUp;h.vertEq(a.Org,n)?(v(!1),b.spliceMergeVertices(e,a,n.anEdge)):h.vertEq(a.Dst,n)?(v(!1),t=b.topRightRegion(t),r=o=(i=(s=b.regionBelow(t)).eUp.Sym).Onext,s.fixUpperEdge&&(v(r!==i),b.deleteRegion(e,s),e.mesh.delete(i),i=r.Oprev),e.mesh.splice(n.anEdge,i),h.edgeGoesLeft(r)||(r=null),b.addRightEdges(e,t,i.Onext,o,r,!0)):(e.mesh.splitEdge(a.Sym),t.fixUpperEdge&&(e.mesh.delete(a.Onext),t.fixUpperEdge=!1),e.mesh.splice(n.anEdge,a),b.sweepEvent(e,n))},b.connectLeftVertex=function(e,t){var n,r,i,o=new we;o.eUp=t.anEdge.Sym,o=e.dict.search(o).key,(n=b.regionBelow(o))&&(r=o.eUp,i=n.eUp,0===h.edgeSign(r.Dst,t,r.Org)?b.connectLeftDegenerate(e,o,t):(n=h.vertLeq(i.Dst,r.Dst)?o:n,o.inside||n.fixUpperEdge?(r=n===o?e.mesh.connect(t.anEdge.Sym,r.Lnext):e.mesh.connect(i.Dnext,t.anEdge).Sym,n.fixUpperEdge?b.fixUpperEdge(e,n,r):b.computeWinding(e,b.addRegionBelow(e,o,r)),b.sweepEvent(e,t)):b.addRightEdges(e,o,t.anEdge,t.anEdge,null,!0)))},b.sweepEvent=function(e,t){e.event=t,b.debugEvent(e);for(var n=t.anEdge;null===n.activeRegion;)if((n=n.Onext)==t.anEdge)return void b.connectLeftVertex(e,t);var r=b.topLeftRegion(e,n.activeRegion),i=(v(null!==r),b.regionBelow(r)),o=i.eUp,i=b.finishLeftRegions(e,i,null);i.Onext===o?b.connectRightVertex(e,r,i):b.addRightEdges(e,r,i.Onext,o,o,!0)},b.addSentinel=function(e,t,n,r){var i=new we,o=e.mesh.makeEdge();o.Org.s=n,o.Org.t=r,o.Dst.s=t,o.Dst.t=r,e.event=o.Dst,i.eUp=o,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=e.dict.insert(i)},b.initEdgeDict=function(e){e.dict=new xe(e,b.edgeLeq);var t=e.bmax[0]-e.bmin[0],n=e.bmax[1]-e.bmin[1],r=e.bmin[0]-t,t=e.bmax[0]+t,i=e.bmin[1]-n,n=e.bmax[1]+n;b.addSentinel(e,r,t,i),b.addSentinel(e,r,t,n)},b.doneEdgeDict=function(e){for(var t,n=0;null!==(t=e.dict.min().key);)t.sentinel||(v(t.fixUpperEdge),v(1==++n)),v(0==t.windingNumber),b.deleteRegion(e,t)},b.removeDegenerateEdges=function(e){for(var t,n,r=e.mesh.eHead,i=r.next;i!==r;i=t)t=i.next,n=i.Lnext,h.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(b.spliceMergeVertices(e,n,i),e.mesh.delete(i),n=(i=n).Lnext),n.Lnext===i&&(n!==i&&(n!==t&&n!==t.Sym||(t=t.next),e.mesh.delete(n)),i!==t&&i!==t.Sym||(t=t.next),e.mesh.delete(i))},b.initPriorityQ=function(e){for(var t,n=0,r=e.mesh.vHead,i=r.next;i!==r;i=i.next)n++;for(t=e.pq=new _e(n+=8,h.vertLeq),i=(r=e.mesh.vHead).next;i!==r;i=i.next)i.pqHandle=t.insert(i);return i===r&&(t.init(),!0)},b.donePriorityQ=function(e){e.pq=null},b.removeDegenerateFaces=function(e,t){for(var n,r,i=t.fHead.next;i!==t.fHead;i=n)n=i.next,r=i.anEdge,v(r.Lnext!==r),r.Lnext.Lnext===r&&(b.addWinding(r.Onext,r),e.mesh.delete(r));return!0},b.computeInterior=function(e){var t,n;if(b.removeDegenerateEdges(e),!b.initPriorityQ(e))return!1;for(b.initEdgeDict(e);null!==(t=e.pq.extractMin());){for(;null!==(n=e.pq.min())&&h.vertEq(n,t);)n=e.pq.extractMin(),b.spliceMergeVertices(e,t.anEdge,n.anEdge);b.sweepEvent(e,t)}return e.event=e.dict.min().key.eUp.Org,b.debugEvent(e),b.doneEdgeDict(e),b.donePriorityQ(e),!!b.removeDegenerateFaces(e,e.mesh)&&(e.mesh.check(),!0)},be.prototype={dot_:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},normalize_:function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];v(0<t),t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},longAxis_:function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),t=Math.abs(e[2])>Math.abs(e[t])?2:t},computeNormal_:function(e){for(var t,n,r,i,o,s=[0,0,0],a=[0,0,0],u=[0,0,0],l=[0,0,0],c=[0,0,0],f=[null,null,null],h=[null,null,null],d=this.mesh.vHead,p=d.next,v=0;v<3;++v)r=p.coords[v],a[v]=r,h[v]=p,s[v]=r,f[v]=p;for(p=d.next;p!==d;p=p.next)for(v=0;v<3;++v)(r=p.coords[v])<a[v]&&(a[v]=r,h[v]=p),s[v]<r&&(s[v]=r,f[v]=p);if(s[v=s[v=s[v=0]-a[0]<s[1]-a[1]?1:v]-a[v]<s[2]-a[2]?2:v]<=a[v])e[0]=0,e[1]=0,e[2]=1;else{for(u[o=0]=(t=h[v]).coords[0]-(n=f[v]).coords[0],u[1]=t.coords[1]-n.coords[1],u[2]=t.coords[2]-n.coords[2],p=d.next;p!==d;p=p.next)l[0]=p.coords[0]-n.coords[0],l[1]=p.coords[1]-n.coords[1],l[2]=p.coords[2]-n.coords[2],c[0]=u[1]*l[2]-u[2]*l[1],c[1]=u[2]*l[0]-u[0]*l[2],c[2]=u[0]*l[1]-u[1]*l[0],o<(i=c[0]*c[0]+c[1]*c[1]+c[2]*c[2])&&(o=i,e[0]=c[0],e[1]=c[1],e[2]=c[2]);o<=0&&(e[0]=e[1]=e[2]=0,e[this.longAxis_(u)]=1)}},checkOrientation_:function(){for(var e,t,n=this.mesh.fHead,r=this.mesh.vHead,i=0,o=n.next;o!==n;o=o.next)if(!((t=o.anEdge).winding<=0))for(;i+=(t.Org.s-t.Dst.s)*(t.Org.t+t.Dst.t),(t=t.Lnext)!==o.anEdge;);if(i<0){for(e=r.next;e!==r;e=e.next)e.t=-e.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},projectPolygon_:function(){var e,t,n,r,i,o=this.mesh.vHead,s=[0,0,0],a=!1;for(s[0]=this.normal[0],s[1]=this.normal[1],s[2]=this.normal[2],0===s[0]&&0===s[1]&&0===s[2]&&(this.computeNormal_(s),a=!0),t=this.sUnit,n=this.tUnit,t[r=this.longAxis_(s)]=0,t[(r+1)%3]=1,t[(r+2)%3]=0,n[r]=0,n[(r+1)%3]=0,n[(r+2)%3]=0<s[r]?1:-1,e=o.next;e!==o;e=e.next)e.s=this.dot_(e.coords,t),e.t=this.dot_(e.coords,n);for(a&&this.checkOrientation_(),i=!0,e=o.next;e!==o;e=e.next)i?(this.bmin[0]=this.bmax[0]=e.s,this.bmin[1]=this.bmax[1]=e.t,i=!1):(e.s<this.bmin[0]&&(this.bmin[0]=e.s),e.s>this.bmax[0]&&(this.bmax[0]=e.s),e.t<this.bmin[1]&&(this.bmin[1]=e.t),e.t>this.bmax[1]&&(this.bmax[1]=e.t))},addWinding_:function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},tessellateMonoRegion_:function(e,t){for(r=t.anEdge,v(r.Lnext!==r&&r.Lnext.Lnext!==r);h.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;h.vertLeq(r.Org,r.Dst);r=r.Lnext);for(n=r.Lprev;r.Lnext!==n;)if(h.vertLeq(r.Dst,n.Org)){for(;n.Lnext!==r&&(h.edgeGoesLeft(n.Lnext)||h.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)var n=e.connect(n.Lnext,n).Sym;n=n.Lprev}else{for(;n.Lnext!=r&&(h.edgeGoesRight(r.Lprev)||0<=h.edgeSign(r.Dst,r.Org,r.Lprev.Org));)var r=e.connect(r,r.Lprev).Sym;r=r.Lnext}for(v(n.Lnext!==r);n.Lnext.Lnext!==r;)n=e.connect(n.Lnext,n).Sym;return!0},tessellateInterior_:function(e){for(var t,n=e.fHead.next;n!==e.fHead;n=t)if(t=n.next,n.inside&&!this.tessellateMonoRegion_(e,n))return!1;return!0},discardExterior_:function(e){for(var t,n=e.fHead.next;n!==e.fHead;n=t)t=n.next,n.inside||e.zapFace(n)},setWindingNumber_:function(e,t,n){for(var r,i=e.eHead.next;i!==e.eHead;i=r)r=i.next,i.Rface.inside!==i.Lface.inside?i.winding=i.Lface.inside?t:-t:n?e.delete(i):i.winding=0},getNeighbourFace_:function(e){return e.Rface&&e.Rface.inside?e.Rface.n:-1},outputPolymesh_:function(e,t,n,r){var i,o,s,a,u,l=0,c=0;for(3<n&&e.mergeConvexFaces(n),i=e.vHead.next;i!==e.vHead;i=i.next)i.n=-1;for(h=e.fHead.next;h!=e.fHead;h=h.next)if(h.n=-1,h.inside){for(o=h.anEdge,s=0;-1===(i=o.Org).n&&(i.n=c,c++),s++,(o=o.Lnext)!==h.anEdge;);v(s<=n),h.n=l,++l}for(this.elementCount=l,t==g.CONNECTED_POLYGONS&&(l*=2),this.elements=[],this.elements.length=l*n,this.vertexCount=c,this.vertices=[],this.vertices.length=c*r,this.vertexIndices=[],this.vertexIndices.length=c,i=e.vHead.next;i!==e.vHead;i=i.next)-1!=i.n&&(u=i.n*r,this.vertices[0+u]=i.coords[0],this.vertices[1+u]=i.coords[1],2<r&&(this.vertices[2+u]=i.coords[2]),this.vertexIndices[i.n]=i.idx);for(var f=0,h=e.fHead.next;h!==e.fHead;h=h.next)if(h.inside){for(o=h.anEdge,s=0;i=o.Org,this.elements[f++]=i.n,s++,(o=o.Lnext)!==h.anEdge;);for(a=s;a<n;++a)this.elements[f++]=-1;if(t==g.CONNECTED_POLYGONS){for(o=h.anEdge;this.elements[f++]=this.getNeighbourFace_(o),(o=o.Lnext)!==h.anEdge;);for(a=s;a<n;++a)this.elements[f++]=-1}}},outputContours_:function(e,t){var n,r,i=0,o=0;for(this.vertexCount=0,this.elementCount=0,l=e.fHead.next;l!==e.fHead;l=l.next)if(l.inside){for(r=n=l.anEdge;this.vertexCount++,(n=n.Lnext)!==r;);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*t,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;for(var s=0,a=0,u=0,i=0,l=e.fHead.next;l!==e.fHead;l=l.next)if(l.inside){for(o=0,r=n=l.anEdge;this.vertices[s++]=n.Org.coords[0],this.vertices[s++]=n.Org.coords[1],2<t&&(this.vertices[s++]=n.Org.coords[2]),this.vertexIndices[a++]=n.Org.idx,o++,(n=n.Lnext)!==r;);this.elements[u++]=i,i+=this.elements[u++]=o}},addContour:function(e,t){var n,r;for(null===this.mesh&&(this.mesh=new ve),3<(e=e<2?2:e)&&(e=3),n=null,r=0;r<t.length;r+=e)null==n?(n=this.mesh.makeEdge(),this.mesh.splice(n,n.Sym)):(this.mesh.splitEdge(n),n=n.Lnext),n.Org.coords[0]=t[r+0],n.Org.coords[1]=t[r+1],n.Org.coords[2]=2<e?t[r+2]:0,n.Org.idx=this.vertexIndexCounter++,n.winding=1,n.Sym.winding=-1},tesselate:function(e,t,n,r,i){if(this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,i&&(this.normal[0]=i[0],this.normal[1]=i[1],this.normal[2]=i[2]),this.windingRule=e,3<(r=r<2?2:r)&&(r=3),!this.mesh)return!1;this.projectPolygon_(),b.computeInterior(this);i=this.mesh;return t==g.BOUNDARY_CONTOURS?this.setWindingNumber_(i,1,!0):this.tessellateInterior_(i),i.check(),t==g.BOUNDARY_CONTOURS?this.outputContours_(i,r):this.outputPolymesh_(i,t,n,r),!0}};var Oe=Object.prototype.hasOwnProperty;var Ee=n,Le=function(){for(var e={},t=0;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Oe.call(r,n)&&(e[n]=r[n])}return e},Se=q(function(e,t){if(t=t||{},0===(e=e.filter(function(e){return 0<e.length})).length)return{positions:[],cells:[]};"number"!=typeof t.vertexSize&&(t.vertexSize=e[0][0].length),e=e.map(function(e){return e.reduce(function(e,t){return e.concat(t)})});for(var n=Ee.tesselate(Le({contours:e,windingRule:Ee.WINDING_ODD,elementType:Ee.POLYGONS,polySize:3,vertexSize:2},t)),r=[],i=0;i<n.vertices.length;i+=t.vertexSize){var o=n.vertices.slice(i,i+t.vertexSize);r.push(o)}for(var s=[],i=0;i<n.elements.length;i+=3){var a=n.elements[i],u=n.elements[i+1],l=n.elements[i+2];s.push([a,u,l])}return{positions:r,cells:s}});function ke(e,t,n){var r=t;if(n=n||1,!t)return{lines:new Float32Array,triangles:new Float32Array,closed:!1,z:0};var i=e._pathCache[r];if(void 0!==i)return i;i=(i=he(z(t))).map(function(e){return $(e,n)});try{p=Se(i)}catch(e){p={positions:[],cells:[]}}for(var o=e._randomZ?.25*(Math.random()-.5):0,s=[],a=p.cells.length,u=p.cells,l=p.positions,c=0;c<a;c++){var f=u[c],h=l[f[0]],d=l[f[1]],f=l[f[2]];s.push(h[0],h[1],o,d[0],d[1],o,f[0],f[1],o)}var p={lines:i,triangles:s,closed:t.endsWith("Z"),z:o,key:r};return e._pathCache[r]=p,e._pathCacheSize++,1e4<e._pathCacheSize&&(e._pathCache={},e._pathCacheSize=0),p}function E(e){return function(){return e}}const Ce=Math.abs,C=Math.atan2,T=Math.cos,Re=Math.max,Be=Math.min,M=Math.sin,A=Math.sqrt,D=1e-12,Ue=Math.PI,Te=Ue/2,Me=2*Ue;function Ae(e){return 1<=e?Te:e<=-1?-Te:Math.asin(e)}const De=Math.PI,Ie=2*De,L=1e-6,Pe=Ie-L;function Ve(n){this._+=n[0];for(let e=1,t=n.length;e<t;++e)this._+=arguments[e]+n[e]}class qe{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==e?Ve:function(e){var t=Math.floor(e);if(!(0<=t))throw new Error("invalid digits: "+e);if(15<t)return Ve;const r=10**t;return function(n){this._+=n[0];for(let e=1,t=n.length;e<t;++e)this._+=Math.round(arguments[e]*r)/r+n[e]}}(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,n,r){this._append`Q${+e},${+t},${this._x1=+n},${this._y1=+r}`}bezierCurveTo(e,t,n,r,i,o){this._append`C${+e},${+t},${+n},${+r},${this._x1=+i},${this._y1=+o}`}arcTo(e,t,n,r,i){if(e=+e,t=+t,n=+n,r=+r,(i=+i)<0)throw new Error("negative radius: "+i);var o,s,a=this._x1,u=this._y1,l=n-e,c=r-t,f=a-e,h=u-t,d=f*f+h*h;null===this._x1?this._append`M${this._x1=e},${this._y1=t}`:d>L&&(Math.abs(h*l-c*f)>L&&i?(s=l*l+c*c,r=(n=n-a)*n+(a=r-u)*a,u=Math.sqrt(s),o=Math.sqrt(d),d=(s=i*Math.tan((De-Math.acos((s+d-r)/(2*u*o)))/2))/o,r=s/u,Math.abs(d-1)>L&&this._append`L${e+d*f},${t+d*h}`,this._append`A${i},${i},0,0,${+(f*a<h*n)},${this._x1=e+r*l},${this._y1=t+r*c}`):this._append`L${this._x1=e},${this._y1=t}`)}arc(e,t,n,r,i,o){if(e=+e,t=+t,o=!!o,(n=+n)<0)throw new Error("negative radius: "+n);let s=n*Math.cos(r),a=n*Math.sin(r),u=e+s,l=t+a,c=1^o,f=o?r-i:i-r;null===this._x1?this._append`M${u},${l}`:(Math.abs(this._x1-u)>L||Math.abs(this._y1-l)>L)&&this._append`L${u},${l}`,n&&((f=f<0?f%Ie+Ie:f)>Pe?this._append`A${n},${n},0,1,${c},${e-s},${t-a}A${n},${n},0,1,${c},${this._x1=u},${this._y1=l}`:f>L&&this._append`A${n},${n},0,${+(f>=De)},${c},${this._x1=e+n*Math.cos(i)},${this._y1=t+n*Math.sin(i)}`)}rect(e,t,n,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${n=+n}v${+r}h${-n}Z`}toString(){return this._}}function Fe(n){let r=3;return n.digits=function(e){if(!arguments.length)return r;if(null==e)r=null;else{var t=Math.floor(e);if(!(0<=t))throw new RangeError("invalid digits: "+e);r=t}return n},()=>new qe(r)}function Ne(e){return e.innerRadius}function Ge(e){return e.outerRadius}function ze(e){return e.startAngle}function He(e){return e.endAngle}function We(e){return e&&e.padAngle}function $e(e,t,n,r,i,o,s){var a=e-n,u=t-r,s=(s?o:-o)/A(a*a+u*u),u=s*u,s=-s*a,a=e+u,e=t+s,t=n+u,n=r+s,r=(a+t)/2,l=(e+n)/2,c=t-a,f=n-e,h=c*c+f*f,o=i-o,a=a*n-t*e,n=(f<0?-1:1)*A(Re(0,o*o*h-a*a)),t=(a*f-c*n)/h,e=(-a*c-f*n)/h,d=(a*f+c*n)/h,a=(-a*c+f*n)/h,c=t-r,f=e-l,n=d-r,h=a-l;return n*n+h*h<c*c+f*f&&(t=d,e=a),{cx:t,cy:e,x01:-u,y01:-s,x11:t*(i/o-1),y11:e*(i/o-1)}}function Ye(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function je(e){this._context=e}function Qe(e){return new je(e)}function Ze(e){return e[0]}function Xe(e){return e[1]}function Je(s,a){var u=E(!0),l=null,c=Qe,f=null,h=Fe(t);function t(e){var t,n,r,i=(e=Ye(e)).length,o=!1;for(null==l&&(f=c(r=h())),t=0;t<=i;++t)!(t<i&&u(n=e[t],t,e))===o&&((o=!o)?f.lineStart():f.lineEnd()),o&&f.point(+s(n,t,e),+a(n,t,e));if(r)return f=null,r+""||null}return s="function"==typeof s?s:void 0===s?Ze:E(s),a="function"==typeof a?a:void 0===a?Xe:E(a),t.x=function(e){return arguments.length?(s="function"==typeof e?e:E(+e),t):s},t.y=function(e){return arguments.length?(a="function"==typeof e?e:E(+e),t):a},t.defined=function(e){return arguments.length?(u="function"==typeof e?e:E(!!e),t):u},t.curve=function(e){return arguments.length?(c=e,null!=l&&(f=c(l)),t):c},t.context=function(e){return arguments.length?(null==e?l=f=null:f=c(l=e),t):l},t}function Ke(c,f,h){var d=null,p=E(!0),v=null,g=Qe,x=null,m=Fe(t);function t(e){var t,n,r,i,o,s=(e=Ye(e)).length,a=!1,u=new Array(s),l=new Array(s);for(null==v&&(x=g(o=m())),t=0;t<=s;++t){if(!(t<s&&p(i=e[t],t,e))===a)if(a=!a)n=t,x.areaStart(),x.lineStart();else{for(x.lineEnd(),x.lineStart(),r=t-1;n<=r;--r)x.point(u[r],l[r]);x.lineEnd(),x.areaEnd()}a&&(u[t]=+c(i,t,e),l[t]=+f(i,t,e),x.point(d?+d(i,t,e):u[t],h?+h(i,t,e):l[t]))}if(o)return x=null,o+""||null}function e(){return Je().defined(p).curve(g).context(v)}return c="function"==typeof c?c:void 0===c?Ze:E(+c),f="function"==typeof f?f:E(void 0===f?0:+f),h="function"==typeof h?h:void 0===h?Xe:E(+h),t.x=function(e){return arguments.length?(c="function"==typeof e?e:E(+e),d=null,t):c},t.x0=function(e){return arguments.length?(c="function"==typeof e?e:E(+e),t):c},t.x1=function(e){return arguments.length?(d=null==e?null:"function"==typeof e?e:E(+e),t):d},t.y=function(e){return arguments.length?(f="function"==typeof e?e:E(+e),h=null,t):f},t.y0=function(e){return arguments.length?(f="function"==typeof e?e:E(+e),t):f},t.y1=function(e){return arguments.length?(h=null==e?null:"function"==typeof e?e:E(+e),t):h},t.lineX0=t.lineY0=function(){return e().x(c).y(f)},t.lineY1=function(){return e().x(c).y(h)},t.lineX1=function(){return e().x(d).y(f)},t.defined=function(e){return arguments.length?(p="function"==typeof e?e:E(!!e),t):p},t.curve=function(e){return arguments.length?(g=e,null!=v&&(x=g(v)),t):g},t.context=function(e){return arguments.length?(null==e?v=x=null:x=g(v=e),t):v},t}je.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};var et={draw(e,t){t=A(t/Ue);e.moveTo(t,0),e.arc(0,0,t,0,Me)}};function tt(e){return e.x||0}function nt(e){return e.y||0}function rt(e){return e.width||0}function it(e){return e.height||0}function ot(e){return e.cornerRadius||0}function st(e){return!(!1===e.defined)}at=Ne,ut=Ge,lt=E(0),ft=ze,ht=He,dt=We,I=ct=null,pt=Fe(r),r.centroid=function(){var e=(+at.apply(this,arguments)+ +ut.apply(this,arguments))/2,t=(+ft.apply(this,arguments)+ +ht.apply(this,arguments))/2-Ue/2;return[T(t)*e,M(t)*e]},r.innerRadius=function(e){return arguments.length?(at="function"==typeof e?e:E(+e),r):at},r.outerRadius=function(e){return arguments.length?(ut="function"==typeof e?e:E(+e),r):ut},r.cornerRadius=function(e){return arguments.length?(lt="function"==typeof e?e:E(+e),r):lt},r.padRadius=function(e){return arguments.length?(ct=null==e?null:"function"==typeof e?e:E(+e),r):ct},r.startAngle=function(e){return arguments.length?(ft="function"==typeof e?e:E(+e),r):ft},r.endAngle=function(e){return arguments.length?(ht="function"==typeof e?e:E(+e),r):ht},r.padAngle=function(e){return arguments.length?(dt="function"==typeof e?e:E(+e),r):dt},r.context=function(e){return arguments.length?(I=null==e?null:e,r):I};var at,ut,lt,ct,ft,ht,dt,I,pt,vt=r.cornerRadius(ot).padAngle(function(e){return e.padAngle||0}),gt=Ke().x(tt).y1(nt).y0(function(e){return(e.y||0)+(e.height||0)}).defined(st),xt=Ke().y(nt).x1(tt).x0(function(e){return(e.x||0)+(e.width||0)}).defined(st);function r(){var e,t,n,r,i,o,s,a,u,l,c,f,h,d,p,v,g,x,m,y,_,w,b=+at.apply(this,arguments),O=+ut.apply(this,arguments),E=ft.apply(this,arguments)-Te,L=ht.apply(this,arguments)-Te,S=Ce(L-E),k=E<L;if(I=I||(e=pt()),O<b&&(t=O,O=b,b=t),O>D?S>Me-D?(I.moveTo(O*T(E),O*M(E)),I.arc(0,0,O,E,L,!k),b>D&&(I.moveTo(b*T(L),b*M(L)),I.arc(0,0,b,L,E,k))):(r=t=E,i=n=L,s=o=S,h=(c=dt.apply(this,arguments)/2)>D&&(ct?+ct.apply(this,arguments):A(b*b+O*O)),w=_=a=Be(Ce(O-b)/2,+lt.apply(this,arguments)),h>D&&(f=Ae(h/b*M(c)),h=Ae(h/O*M(c)),(o-=2*f)>D?(r+=f*=k?1:-1,i-=f):(o=0,r=i=(E+L)/2),(s-=2*h)>D?(t+=h*=k?1:-1,n-=h):(s=0,t=n=(E+L)/2)),c=O*T(t),f=O*M(t),h=b*T(i),E=b*M(i),a>D&&(d=O*T(n),p=O*M(n),v=b*T(r),g=b*M(r),S<Ue)&&((L=function(e,t,n,r,i,o,s,a){var u=(a=a-o)*(n=n-e)-(s=s-i)*(r=r-t);if(!(u*u<D))return[e+(u=(s*(t-o)-a*(e-i))/u)*n,t+u*r]}(c,f,v,g,d,p,h,E))?(S=c-L[0],m=f-L[1],y=d-L[0],x=p-L[1],m=1/M((1<(S=(S*y+m*x)/(A(S*S+m*m)*A(y*y+x*x)))?0:S<-1?Ue:Math.acos(S))/2),y=A(L[0]*L[0]+L[1]*L[1]),_=Be(a,(b-y)/(m-1)),w=Be(a,(O-y)/(1+m))):_=w=0),s>D?w>D?(u=$e(v,g,c,f,O,w,k),l=$e(d,p,h,E,O,w,k),I.moveTo(u.cx+u.x01,u.cy+u.y01),w<a?I.arc(u.cx,u.cy,w,C(u.y01,u.x01),C(l.y01,l.x01),!k):(I.arc(u.cx,u.cy,w,C(u.y01,u.x01),C(u.y11,u.x11),!k),I.arc(0,0,O,C(u.cy+u.y11,u.cx+u.x11),C(l.cy+l.y11,l.cx+l.x11),!k),I.arc(l.cx,l.cy,w,C(l.y11,l.x11),C(l.y01,l.x01),!k))):(I.moveTo(c,f),I.arc(0,0,O,t,n,!k)):I.moveTo(c,f),b>D&&o>D?_>D?(u=$e(h,E,d,p,b,-_,k),l=$e(c,f,v,g,b,-_,k),I.lineTo(u.cx+u.x01,u.cy+u.y01),_<a?I.arc(u.cx,u.cy,_,C(u.y01,u.x01),C(l.y01,l.x01),!k):(I.arc(u.cx,u.cy,_,C(u.y01,u.x01),C(u.y11,u.x11),!k),I.arc(0,0,b,C(u.cy+u.y11,u.cx+u.x11),C(l.cy+l.y11,l.cx+l.x11),k),I.arc(l.cx,l.cy,_,C(l.y11,l.x11),C(l.y01,l.x01),!k))):I.arc(0,0,b,i,r,k):I.lineTo(h,E)):I.moveTo(0,0),I.closePath(),e)return I=null,e+""||null}Je().x(tt).y(nt).defined(st);var mt=d.pathTrail().x(tt).y(nt).defined(st).size(function(e){return e.width||e.height||1});d.pathRectangle().x(tt).y(nt).width(rt).height(it).cornerRadius(ot),d.pathRectangle().x(0).y(0).width(rt).height(it).cornerRadius(ot),function(t,n){let r=null,i=Fe(o);function o(){let e;if(r=r||(e=i()),t.apply(this,arguments).draw(r,+n.apply(this,arguments)),e)return r=null,e+""||null}return t="function"==typeof t?t:E(t||et),n="function"==typeof n?n:E(void 0===n?64:+n),o.type=function(e){return arguments.length?(t="function"==typeof e?e:E(e),o):t},o.size=function(e){return arguments.length?(n="function"==typeof e?e:E(+e),o):n},o.context=function(e){return arguments.length?(r=null==e?null:e,o):r},o}().type(function(e){return d.pathSymbols(e.shape||"circle")}).size(function(e){return null==e.size?64:e.size});function yt(e,t){return e[0]*t[0]+e[1]*t[1]}var _t,wt,bt,Ot,Et,Lt,St,kt,o={};function Ct(){return wt||(wt=1,_t=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}),_t}function Rt(){return Ot||(Ot=1,bt=function(e,t,n){return e[0]=t,e[1]=n,e}),bt}function Bt(){return Lt||(Lt=1,Et=function(e,t){var n=t[0],r=t[1],n=n*n+r*r;0<n&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n);return e}),Et}function Ut(){return kt||(kt=1,St=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}),St}var Tt,Mt,At,Dt,It,Pt,Vt=function(e,t){return"number"==typeof e?e:"number"==typeof t?t:0},S={create:function(){return[0,0]},clone:function(e){return[e[0],e[1]]},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},scaleAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e},dot:yt},k=S.create(),qt=S.create(),Ft=S.create(),Nt=S.create(),Gt=S.create(),zt=S.create(),n=(s||(s=1,Tt=Ct(),Mt=Rt(),At=Bt(),Dt=Ut(),It=yt,Pt=[0,0],o.computeMiter=function(e,t,n,r,i){return Tt(e,n,r),At(e,e),Mt(t,-e[1],e[0]),Mt(Pt,-n[1],n[0]),i/It(t,Pt)},o.normal=function(e,t){return Mt(e,-t[1],t[0]),e},o.direction=function(e,t,n){return Dt(e,t,n),At(e,e),e}),o),Ht=n.computeMiter,Wt=n.normal,$t=n.direction;function Yt(e){if(!(this instanceof Yt))return new Yt(e);this.miterLimit=Vt((e=e||{}).miterLimit,10),this.thickness=Vt(e.thickness,1),this.join=e.join||"miter",this.cap=e.cap||"butt",this._normal=null,this._lastFlip=-1,this._started=!1}function jt(e,t,n,r){S.scaleAndAdd(k,t,n,-r),e.push(S.clone(k)),S.scaleAndAdd(k,t,n,r),e.push(S.clone(k))}Yt.prototype.mapThickness=function(e,t,n){return this.thickness},Yt.prototype.build=function(e){var t={positions:[],cells:[]};if(!(e.length<=1)){var n=e.length;this._lastFlip=-1,this._started=!1,this._normal=null;for(var r=1,i=0;r<n;r++){var o=e[r-1],s=e[r],a=r<e.length-1?e[r+1]:null,u=this.mapThickness(s,r,e);i+=this._seg(t,i,o,s,a,u/2)}}return t},Yt.prototype._seg=function(e,t,n,r,i,o){var s=0,a=e.cells,e=e.positions,u="square"===this.cap,l="bevel"===this.join;return $t(Ft,r,n),this._normal||(this._normal=S.create(),Wt(this._normal,Ft)),this._started||(this._started=!0,u&&(S.scaleAndAdd(qt,n,Ft,-o),n=qt),jt(e,n,this._normal,o)),a.push([t+0,t+1,t+2]),i?($t(Nt,i,r),n=Ht(Gt,zt,Ft,Nt,o),i=S.dot(Gt,this._normal)<0?-1:1,(l=l)||"miter"!==this.join||n/o>this.miterLimit&&(l=!0),l?(S.scaleAndAdd(k,r,this._normal,-o*i),e.push(S.clone(k)),S.scaleAndAdd(k,r,zt,n*i),e.push(S.clone(k)),a.push(this._lastFlip!==-i?[t,t+2,t+3]:[t+2,t+1,t+3]),a.push([t+2,t+3,t+4]),Wt(k,Nt),S.copy(this._normal,k),S.scaleAndAdd(k,r,k,-o*i),e.push(S.clone(k)),s+=3):(jt(e,r,zt,n),a.push(1===this._lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3]),i=-1,S.copy(this._normal,zt),s+=2),this._lastFlip=i):(Wt(this._normal,Ft),u&&(S.scaleAndAdd(qt,r,Ft,o),r=qt),jt(e,r,this._normal,o),a.push(1===this._lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3]),s+=2),s};var Qt=q(Yt);function Zt(e,t,n,r){if((r=void 0===r?!1:r)&&n.key){r=e._geometryCache[n.key];if(r)return r}var i,o,s,a,u,l,c,f,h,d,p,v,g,r=null!=(r=t.strokeWidth)?r:1,x=null!=(x=t.strokeCap)?x:"butt",m=[],y=0,_=0,w=!1,b=!1,O=null==t.opacity?1:t.opacity,E=O*(null==t.fillOpacity?1:t.fillOpacity),L=O*(null==t.strokeOpacity?1:t.strokeOpacity),S=(n.z,n.triangles);if("transparent"===t.fill&&(E=0),t.fill&&0<E&&(w=!0,y=S?S.length/9:0),"transparent"===t.stroke&&(L=0),0<r&&t.stroke&&0<L)for(b=!0,g=Qt({thickness:r,cap:x,join:"miter",miterLimit:1,closed:!!n.closed}),a=0;a<n.lines.length;a++)l=g.build(n.lines[a]),m.push(l),_+=l.cells.length;var k=new Float32Array(3*y*3),C=new Float32Array(3*_*3),R=new Float32Array(3*y*4),B=new Float32Array(3*_*4);if(w){for(s=U.from(t.fill),i=0,o=S.length;i<o;i+=3)k[i]=S[i]+e._tx,k[i+1]=S[i+1]+e._ty,k[i+2]=S[i+2];for(i=0,o=S.length/3;i<o;i++)R[4*i]=s[0],R[4*i+1]=s[1],R[4*i+2]=s[2],R[4*i+3]=E}if(b)for(s=U.from(t.stroke),a=i=0;a<m.length;a++)for(d=(l=m[a]).positions,p=l.cells,v=l.cells.length,u=0;u<v;u++)c=d[(h=p[u])[0]],f=d[h[1]],h=d[h[2]],C[3*i]=c[0]+e._tx,C[3*i+1]=c[1]+e._ty,C[3*i+2]=-.1,B[4*i]=s[0],B[4*i+1]=s[1],B[4*i+2]=s[2],B[4*i+3]=L,C[3*++i]=f[0]+e._tx,C[3*i+1]=f[1]+e._ty,C[3*i+2]=-.1,B[4*i]=s[0],B[4*i+1]=s[1],B[4*i+2]=s[2],B[4*i+3]=L,C[3*++i]=h[0]+e._tx,C[3*i+1]=h[1]+e._ty,C[3*i+2]=-.1,B[4*i]=s[0],B[4*i+1]=s[1],B[4*i+2]=s[2],B[4*i+3]=L,i++;return e._geometryCache[n.key]=O={fillTriangles:k,strokeTriangles:C,fill:R,stroke:B,fillCount:3*y,strokeCount:3*_},e._geometryCacheSize++,1e4<e._geometryCacheSize&&(e._geometryCache={},e._geometryCacheSize=0),O}var Xt="Arc",s={type:"arc",draw:function(e,t,n,r){var i=n.items;if(null!=i&&i.length){!function(e,t,n){Jt!=e&&(Jt=e,0);Kt=new _(e,Xt,t._uniforms.resolution,[n.x1,n.y1]),en=t._shaderCache.Arc,tn=new y(["float32x3","float32x4"],["float32x2"]),nn=w.createRenderPipeline(Xt,e,en,w.colorFormat,tn.getBuffers()),rn=w.createRenderPassDescriptor(Xt,t.background,t.depthTexture.createView()),0;rn.colorAttachments[0].view=t.getCurrentTexture().createView()}(e,t,r),Kt.setResolution(t._uniforms.resolution),Kt.setOffset([r.x1,r.y1]);var o,n=Kt.createUniformBuffer(),s=w.createUniformBindGroup(Xt,e,nn,n);for(o in i)for(var a=i[o],u=function(e,t){for(var n=function(e,t){return!e||e.arc?vt.context(e)(t):ke(e,vt.context(null)(t),.1)}(e,t),r=Zt(e,t,n),i=new Float32Array(7*r.fillCount),o=new Float32Array(7*r.strokeCount),s=U.from(t.fill,t.opacity,t.fillOpacity),a=U.from(t.stroke,t.opacity,t.strokeOpacity),u=0;u<r.fillCount;u++)i[7*u]=r.fillTriangles[3*u],i[7*u+1]=r.fillTriangles[3*u+1],i[7*u+2]=-1*r.fillTriangles[3*u+2],i[7*u+3]=s.r,i[7*u+4]=s.g,i[7*u+5]=s.b,i[7*u+6]=s.a;for(u=0;u<r.strokeCount;u++)o[7*u]=r.strokeTriangles[3*u],o[7*u+1]=r.strokeTriangles[3*u+1],o[7*u+2]=-1*r.strokeTriangles[3*u+2],o[7*u+3]=a.r,o[7*u+4]=a.g,o[7*u+5]=a.b,o[7*u+6]=a.a;return[i,o]}(t,a),l=0;l<u.length;l++){var c,f,h=u[l].length/tn.getVertexLength();0!=h&&(c=Kt.createGeometryBuffer(u[l]),f=Kt.createInstanceBuffer(function(e){var t=e.x,t=void 0===t?0:t,e=e.y,e=void 0===e?0:e;return Float32Array.from([t,e])}(a)),w.queue2(e,nn,rn,[h],[c,f],[s],t._clip))}}}},Jt=null,Kt=null,en=null,tn=null,nn=null,rn=null;var on="Area",o={type:"area",draw:function(e,t,n,r){n=n.items;if(null!=n&&n.length){!function(e,t,n){sn!=e&&(sn=e,hn=!1);hn||(an=new _(e,on,t._uniforms.resolution,[n.x1,n.y1]),un=t._shaderCache.Area,ln=new y(["float32x3","float32x4"],[]),cn=w.createRenderPipeline(on,e,un,w.colorFormat,ln.getBuffers()),fn=w.createRenderPassDescriptor(on,t.background,t.depthTexture.createView()),hn=!0);fn.colorAttachments[0].view=t.getCurrentTexture().createView()}(e,t,r),an.setResolution(t._uniforms.resolution),an.setOffset([r.x1,r.y1]);for(var r=n[0],i=function(e,t,n){for(var n=function(e,t){var n=t[0],r="trail"===(r=n.interpolate||"linear")?mt:("horizontal"===n.orient?xt:gt).curve(d.pathCurves(r,n.orient,n.tension));return!e||e.arc?r.context(e)(t):ke(e,r.context(null)(t),.1)}(e,n),r=Zt(e,t,n),i=new Float32Array(7*r.fillCount),o=new Float32Array(7*r.strokeCount),s=U.from2(t.fill,t.opacity,t.fillOpacity),a=U.from2(t.stroke,t.opacity,t.strokeOpacity),u=0;u<r.fillCount;u++)i[7*u]=r.fillTriangles[3*u],i[7*u+1]=r.fillTriangles[3*u+1],i[7*u+2]=-1*r.fillTriangles[3*u+2],i[7*u+3]=s[0],i[7*u+4]=s[1],i[7*u+5]=s[2],i[7*u+6]=s[3];for(u=0;u<r.strokeCount;u++)o[7*u]=r.strokeTriangles[3*u],o[7*u+1]=r.strokeTriangles[3*u+1],o[7*u+2]=-1*r.strokeTriangles[3*u+2],o[7*u+3]=a[0],o[7*u+4]=a[1],o[7*u+5]=a[2],o[7*u+6]=a[3];return[i,o]}(t,r,n),r=an.createUniformBuffer(),o=w.createUniformBindGroup(on,e,cn,r),s=0;s<i.length;s++){var a,u=i[s].length/ln.getVertexLength();0!=u&&(a=an.createGeometryBuffer(i[s]),w.queue2(e,cn,fn,[u],[a],[o],t._clip))}}}},sn=null,an=null,un=null,ln=null,cn=null,fn=null,hn=!1;function dn(e,t){return e.zindex-t.zindex||e.index-t.index}function pn(e,t){var n,r,i=e.items;if(i&&i.length){e=function(e){if(!e.zdirty)return e.zitems;for(var t,n=e.items,r=[],i=0,o=n.length;i<o;++i)(t=n[i]).index=i,t.zindex&&r.push(t);return e.zdirty=!1,e.zitems=r.sort(dn)}(e);if(e&&e.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||t(i[n]);i=e}for(n=0,r=i.length;n<r;++n)t(i[n])}}var vn=Float32Array.from([0,0,0,1,1,0,1,0,0,1,1,1]),gn=(Float32Array.from([0,0,0,1,1,0,1,0,0,1,1,1]),"Group"),xn=null,mn=null,yn=null,_n=null,wn=null,bn=null,On=null,En=!1;var Ln="Line",Sn=null,P=null,kn=null,Cn=null,Rn=null,Bn=null,Un=null,Tn=null,Mn=null,An=!1;var Dn="Rect",In=null,Pn=null,Vn=null,qn=null,Fn=null,Nn=null,Gn=null,zn=!1;var Hn="Rule",Wn=null,$n=null,Yn=null,jn=null,Qn=null,Zn=null,Xn=null,Jn=!1;var Kn=32,er="Symbol",tr=null,nr=null,rr=null,ir=null,or=null,sr=null,ar=!1;var ur="Path",lr=null,cr=null,fr=null,hr=null,dr=null,pr=null,vr=!1;var gr="Shape",xr=null,mr=null,yr=null,_r=null,wr=null,br=null,Or=!1,Er={};var Lr,Sr={arc:s,area:o,group:{type:"group",draw:function(s,a,e,u){var t,n,r,l=this,i=e.items;null!=i&&i.length&&(n=a,r=u,xn!=(t=s)&&(xn=t,En=!1),En||(mn=new _(t,gn,n._uniforms.resolution,[r.x1,r.y1]),yn=n._shaderCache[gn],_n=new y(["float32x2"],["float32x2","float32x2","float32x4","float32x4","float32","float32x4"]),wn=w.createRenderPipeline(gn,t,yn,w.colorFormat,_n.getBuffers()),bn=w.createRenderPassDescriptor(gn,n.background,n.depthTexture.createView()),On=mn.createGeometryBuffer(vn),En=!0),bn.colorAttachments[0].view=n.getCurrentTexture().createView(),mn.setResolution(a._uniforms.resolution),mn.setOffset([u.x1,u.y1]),r=mn.createUniformBuffer(),t=w.createUniformBindGroup(gn,s,wn,r),n=function(e){return Float32Array.from(e.flatMap(function(e){var t=e.x,t=void 0===t?0:t,n=e.y,n=void 0===n?0:n,r=e.width,r=void 0===r?0:r,i=e.height,i=void 0===i?0:i,o=e.opacity,o=void 0===o?1:o,s=e.fill,a=e.fillOpacity,u=e.stroke,u=void 0===u?null:u,l=e.strokeOpacity,l=void 0===l?1:l,c=e.strokeWidth,c=void 0===c?null:c,f=e.cornerRadius,f=void 0===f?0:f,h=e.cornerRadiusBottomLeft,h=void 0===h?null:h,d=e.cornerRadiusBottomRight,d=void 0===d?null:d,p=e.cornerRadiusTopRight,p=void 0===p?null:p,e=e.cornerRadiusTopLeft,e=void 0===e?null:e,s=U.from(s,o,void 0===a?1:a),a=U.from(u,o,l),o=u?null!=c?c:1:null!=c?c:0,l=[null!=p?p:f,null!=d?d:f,null!=h?h:f,null!=e?e:f];return m(m(m(m([t,n,r,i],x(s.rgba),!1),x(a.rgba),!1),[o],!1),x(l),!1)}))}(i),r=mn.createInstanceBuffer(n),w.queue2(s,wn,bn,[6,i.length],[On,r],[t]),pn(e,function(e){var t,n=e.x||0,r=e.y||0,i=e.width||0,o=e.height||0;a._tx+=n,a._ty+=r,a._textContext.save(),a._textContext.translate(n,r),e.clip&&(t=a._clip,a._clip=[(a._origin[0]+a._tx)*a._uniforms.dpi,(a._origin[1]+a._ty)*a._uniforms.dpi,(a._origin[0]+a._tx+i)*a._uniforms.dpi,(a._origin[1]+a._ty+o)*a._uniforms.dpi]),u&&u.translate(-n,-r),pn(e,function(e){l.draw(s,a,e,u)}),u&&u.translate(n,r),e.clip&&(a._clip=t),a._tx-=n,a._ty-=r,a._textContext.restore()}))}},line:{type:"line",draw:function(e,t,n,r){n=n.items;if(null!=n&&n.length){{var i=e;var o=t;var s=r;Sn!=i&&(Sn=i,An=!1);An||(P=new _(i,Ln,o._uniforms.resolution,[s.x1,s.y1]),kn=new y([],["float32x2","float32x2","float32x4","float32","float32x2","float32x2"]),Cn=new y([],["float32x2","float32x2","float32x4","float32"]),Rn=o._shaderCache.Line,Bn=o._shaderCache.SLine,Un=w.createRenderPipeline(Ln,i,Rn,w.colorFormat,kn.getBuffers()),Tn=w.createRenderPipeline("S"+Ln,i,Bn,w.colorFormat,Cn.getBuffers()),Mn=w.createRenderPassDescriptor(Ln,o.background,o.depthTexture.createView()),An=!0);Mn.colorAttachments[0].view=o.getCurrentTexture().createView()}P.setResolution(t._uniforms.resolution),P.setOffset([r.x1,r.y1]);if(!0===t._renderer.wgOptions.renderBatch){s=w.createUniformBindGroup("S"+Ln,e,Tn,P.createUniformBuffer()),i=function(e){for(var t=e,n=new Float32Array(9*(e.length-1)),r=0;r<t.length-1;r++){var i=t[r],o=i.x,o=void 0===o?0:o,s=i.y,s=void 0===s?0:s,a=i.stroke,u=i.strokeOpacity,u=void 0===u?1:u,l=i.strokeWidth,l=void 0===l?1:l,i=i.opacity,i=void 0===i?1:i,c=t[r+1].x,f=t[r+1].y,a=U.from2(a,i,u),i=9*r;n[i]=o,n[1+i]=s,n[2+i]=c,n[3+i]=f,n[4+i]=a[0],n[5+i]=a[1],n[6+i]=a[2],n[7+i]=a[3],n[8+i]=l}return n}(n),o=P.createInstanceBuffer(i);w.queue2(e,Tn,Mn,[6,n.length-1],[o],[s],t._clip)}else{w.setupRenderBatch(e,kn,Un,Mn,t._clip);for(var a=n,u=0;u<a.length-1;u++){var l=a[u],c=l.x,c=void 0===c?0:c,f=l.y,f=void 0===f?0:f,h=l.stroke,d=l.strokeOpacity,d=void 0===d?1:d,p=l.strokeWidth,p=void 0===p?1:p,l=l.opacity,l=void 0===l?1:l,v=a[u+1].x,g=a[u+1].y,h=U.from2(h,l,d),l=m(m([c,f,v,g,h[0],h[1],h[2],h[3],p],x(P.getResolution()),!1),x(P.getOffset()),!1);w.queueRenderBatch(l)}}}},pick:function(){return null}},rect:{type:"rect",draw:function(e,t,n,r){var i,o,s,n=n.items;null!=n&&n.length&&(o=t,s=r,In!=(i=e)&&(In=i,zn=!1),zn||(Pn=new _(i,Dn,o._uniforms.resolution,[s.x1,s.y1]),Vn=o._shaderCache[Dn],qn=new y(["float32x2"],["float32x2","float32x2","float32x4","float32x4","float32","float32x4"]),Fn=w.createRenderPipeline(Dn,i,Vn,w.colorFormat,qn.getBuffers()),Nn=w.createRenderPassDescriptor(Dn,o.background,o.depthTexture.createView()),Gn=Pn.createGeometryBuffer(vn),zn=!0),Nn.colorAttachments[0].view=o.getCurrentTexture().createView(),Pn.setResolution(t._uniforms.resolution),Pn.setOffset([r.x1,r.y1]),s=Pn.createUniformBuffer(),i=w.createUniformBindGroup(Dn,e,Fn,s),o=function(e){return Float32Array.from(e.flatMap(function(e){var t=e.x,t=void 0===t?0:t,n=e.y,n=void 0===n?0:n,r=e.width,r=void 0===r?0:r,i=e.height,i=void 0===i?0:i,o=e.opacity,o=void 0===o?1:o,s=e.fill,a=e.fillOpacity,u=e.stroke,u=void 0===u?null:u,l=e.strokeOpacity,l=void 0===l?1:l,c=e.strokeWidth,c=void 0===c?null:c,f=e.cornerRadius,f=void 0===f?0:f,h=e.cornerRadiusBottomLeft,h=void 0===h?null:h,d=e.cornerRadiusBottomRight,d=void 0===d?null:d,p=e.cornerRadiusTopRight,p=void 0===p?null:p,e=e.cornerRadiusTopLeft,e=void 0===e?null:e,s=U.from(s,o,void 0===a?1:a),a=U.from(u,o,l),o=u?null!=c?c:1:null!=c?c:0,l=[null!=p?p:f,null!=d?d:f,null!=h?h:f,null!=e?e:f];return m(m(m(m([t,n,r,i],x(s.rgba),!1),x(a.rgba),!1),[o],!1),x(l),!1)}))}(n),r=Pn.createInstanceBuffer(o),w.queue2(e,Fn,Nn,[6,n.length],[Gn,r],[i],t._clip))}},rule:{type:"rule",draw:function(e,t,n,r){var i,o,s,n=n.items;null!=n&&n.length&&(o=t,s=r,Wn!=(i=e)&&(Wn=i,Jn=!1),Jn||($n=new _(i,Hn,o._uniforms.resolution,[s.x1,s.y1]),Yn=o._shaderCache[Hn],jn=new y(["float32x2"],["float32x2","float32x2","float32x4"]),Qn=w.createRenderPipeline(Hn,i,Yn,w.colorFormat,jn.getBuffers()),Zn=w.createRenderPassDescriptor(Hn,o.background,o.depthTexture.createView()),Xn=$n.createGeometryBuffer(vn),Jn=!0),Zn.colorAttachments[0].view=o.getCurrentTexture().createView(),$n.setResolution(t._uniforms.resolution),$n.setOffset([r.x1,r.y1]),s=$n.createUniformBuffer(),i=w.createUniformBindGroup(Hn,e,Qn,s),o=function(e){return Float32Array.from(e.flatMap(function(e){var t=e.x,t=void 0===t?0:t,n=e.y,n=void 0===n?0:n,r=e.x2,i=e.y2,o=e.stroke,s=e.strokeWidth,s=void 0===s?1:s,a=e.opacity,a=void 0===a?1:a,e=e.strokeOpacity,e=void 0===e?1:e,u=(null!=r||(r=t),null!=i||(i=n),Math.abs(r-t)),l=Math.abs(i-n),o=U.from(o,a,e);return m([Math.min(t,r),Math.min(n,i),u||s,l||s],x(o.rgba),!1)}))}(n),r=$n.createInstanceBuffer(o),w.queue2(e,Qn,Zn,[6,n.length],[Xn,r],[i],t._clip))}},symbol:{type:"symbol",draw:function(e,t,n,r){var i,o,s,a=n.items;null!=a&&a.length&&(function(e,t,n){tr!=e&&(tr=e,ar=!1);ar||(nr=new _(e,er,t._uniforms.resolution,[n.x1,n.y1]),rr=t._shaderCache.Symbol,ir=new y(["float32x2"],["float32x2","float32","float32x4","float32x4","float32"]),or=w.createRenderPipeline(er,e,rr,w.colorFormat,ir.getBuffers()),sr=nr.createGeometryBuffer(new Float32Array(Array.from({length:Kn},function(e,t){var n=(t+1)%Kn,t=t?2*Math.PI/Kn*t:0,n=n?2*Math.PI/Kn*n:0;return[Math.cos(t),Math.sin(t),0,0,Math.cos(n),Math.sin(n)]}).flat())),ar=!0)}(e,t,r),nr.setResolution(t._uniforms.resolution),nr.setOffset([r.x1,r.y1]),i=nr.createUniformBuffer(),i=w.createUniformBindGroup(er,e,or,i),o=function(e){for(var t=new Float32Array(12*e.length),n=-1,r=0,i=e.length;r<i;r++){var o=e[r],s=o.x,s=void 0===s?0:s,a=o.y,a=void 0===a?0:a,u=o.size,l=o.fill,c=o.stroke,f=o.strokeWidth,f=void 0===f?1:f,h=o.opacity,h=void 0===h?1:h,d=o.fillOpacity,d=void 0===d?1:d,o=o.strokeOpacity,o=void 0===o?1:o,l=U.from2(l,h,d),d=U.from2(c,h,o),h=Math.sqrt(u)/2;t[++n]=s,t[++n]=a,t[++n]=h,t[++n]=l[0],t[++n]=l[1],t[++n]=l[2],t[++n]=l[3],t[++n]=d[0],t[++n]=d[1],t[++n]=d[2],t[++n]=d[3],t[++n]=c?f:0}return t}(a),o=nr.createInstanceBuffer(o),s=t._clip,n.clip&&0!==n.bounds.y2&&(t._clip=[-1*r.x1*t._uniforms.dpi,-1*r.y1*t._uniforms.dpi,(n.bounds.x2||t._uniforms.resolution[0]- -1*r.x1)*t._uniforms.dpi,n.bounds.y2*t._uniforms.dpi]),w.queue2(e,or,null,[3*Kn,a.length],[sr,o],[i],t._clip),n.clip)&&(t._clip=s)},pick:function(){return null}},text:{type:"text",draw:function(e,t,n,r){d.Marks.text.draw(this._textContext,n,r)}},path:{type:"path",draw:function(e,t,n,r){var i=n.items;if(null!=i&&i.length){!function(e,t,n){lr!=e&&(lr=e,vr=!1);vr||(cr=new _(e,ur,t._uniforms.resolution,[n.x1,n.y1]),fr=t._shaderCache.Path,hr=new y(["float32x3","float32x4"]),dr=w.createRenderPipeline(ur,e,fr,w.colorFormat,hr.getBuffers()),pr=w.createRenderPassDescriptor(ur,t.background,t.depthTexture.createView()),vr=!0);pr.colorAttachments[0].view=t.getCurrentTexture().createView()}(e,t,r),cr.setResolution(t._uniforms.resolution),cr.setOffset([r.x1,r.y1]);var o,n=cr.createUniformBuffer(),s=w.createUniformBindGroup(ur,e,dr,n);for(o in i){for(var a=i[o],u=(t._tx+=a.x||0,t._ty+=a.y||0,function(e,t){for(var n=t.path,n=ke(e,n),r=Zt(e,t,n),i=new Float32Array(7*r.fillCount),o=new Float32Array(7*r.strokeCount),s=U.from2(t.fill,t.opacity,t.fillOpacity),a=U.from2(t.stroke,t.opacity,t.strokeOpacity),u=0;u<r.fillCount;u++)i[7*u]=r.fillTriangles[3*u],i[7*u+1]=r.fillTriangles[3*u+1],i[7*u+2]=-1*r.fillTriangles[3*u+2],i[7*u+3]=s[0],i[7*u+4]=s[1],i[7*u+5]=s[2],i[7*u+6]=s[3];for(u=0;u<r.strokeCount;u++)o[7*u]=r.strokeTriangles[3*u],o[7*u+1]=r.strokeTriangles[3*u+1],o[7*u+2]=-1*r.strokeTriangles[3*u+2],o[7*u+3]=a[0],o[7*u+4]=a[1],o[7*u+5]=a[2],o[7*u+6]=a[3];return[i,o]}(t,a)),l=0;l<u.length;l++){var c,f=u[l].length/hr.getVertexLength();0!=f&&(c=cr.createGeometryBuffer(u[l]),w.queue2(e,dr,pr,[f],[c],[s],t._clip))}t._tx-=a.x||0,t._ty-=a.y||0}}}},shape:{type:"shape",draw:function(e,t,n,r){var i=n.items;if(null!=i&&i.length){!function(e,t,n){xr!=e&&(xr=e,Or=!1);Or||(Er={},mr=new _(e,gr,t._uniforms.resolution,[n.x1,n.y1]),yr=t._shaderCache[gr],_r=new y(["float32x3","float32x4"],[]),wr=w.createRenderPipeline(gr,e,yr,w.colorFormat,_r.getBuffers()),br=w.createRenderPassDescriptor(gr,t.background,t.depthTexture.createView()),Or=!0);br.colorAttachments[0].view=t.getCurrentTexture().createView()}(e,t,r),mr.setResolution(t._uniforms.resolution),mr.setOffset([r.x1,r.y1]);var o,n=mr.createUniformBuffer(),s=w.createUniformBindGroup(gr,e,wr,n);for(o in i)for(var a=i[o],u=function(e,t,n){var r=null!=(r=null!=(r=t.datum.id)?r:t.id)?r:t[Object.getOwnPropertySymbols(t)[0]],i=Er[r];if(n&&i&&t.strokeWidth==i.strokeWidth&&t.x==i.x&&t.y==i.y&&t.bounds==i.bounds){var o=U.from2(t.fill,t.opacity,t.fillOpacity),n=U.from2(t.stroke,t.opacity,t.strokeOpacity);if(i.fill==o&&i.stroke==n)return i.data;var s=[new Float32Array(i.data[0].length),new Float32Array(i.data[1].length)];console.log(o);for(var a=0;a<s[0].length;a+=7)s[0][a]=i.data[0][a],s[0][a+1]=i.data[0][a+1],s[0][a+2]=i.data[0][a+2],s[0][a+3]=o[0],s[0][a+4]=o[1],s[0][a+5]=o[2],s[0][a+6]=o[3];for(a=0;a<s[1].length;a+=7)s[1][a]=i.data[1][a],s[1][a+1]=i.data[1][a+1],s[1][a+2]=i.data[1][a+2],s[1][a+3]=o[0],s[1][a+4]=o[1],s[1][a+5]=o[2],s[1][a+6]=o[3];return s}for(var n=function(e,t){var n=t.mark.shape||t.shape;return!e||e.arc?n.context(e)(t):ke(e,n.context(null)(t),.1)}(e,t),u=(n.key=r,Zt(e,t,n)),l=new Float32Array(7*u.fillCount),c=new Float32Array(7*u.strokeCount),f=U.from2(t.fill,t.opacity,t.fillOpacity),h=U.from2(t.stroke,t.opacity,t.strokeOpacity),a=0;a<u.fillCount;a++)l[7*a]=u.fillTriangles[3*a],l[7*a+1]=u.fillTriangles[3*a+1],l[7*a+2]=-1*u.fillTriangles[3*a+2],l[7*a+3]=f[0],l[7*a+4]=f[1],l[7*a+5]=f[2],l[7*a+6]=f[3];for(a=0;a<u.strokeCount;a++)c[7*a]=u.strokeTriangles[3*a],c[7*a+1]=u.strokeTriangles[3*a+1],c[7*a+2]=-1*u.strokeTriangles[3*a+2],c[7*a+3]=h[0],c[7*a+4]=h[1],c[7*a+5]=h[2],c[7*a+6]=h[3];return Er[r]={file:f,stroke:h,x:t.x,y:t.y,bounds:t.bounds,strokeWidth:t.strokeWidth,data:[l,c]},[l,c]}(t,a,null!=(a=t._renderer.wgOptions.cacheShapes)&&a),l=0;l<u.length;l++){var c,f=u[l].length/_r.getVertexLength();0!=f&&(c=mr.createGeometryBuffer(u[l]),w.queue2(e,wr,br,[f],[c],[s],t._clip))}}}},image:{type:"image",draw:function(e,t,n,r){n=n.items;null!=n&&n.length&&console.warn("Image not yet supported!")}}};function kr(e,t,n){return e.fields=t||[],e.fname=n,e}const Cr=t=>function(e){return e[t]},Rr=n=>{const r=n.length;return function(t){for(let e=0;e<r;++e)t=t[n[e]];return t}};function Br(e){throw Error(e)}n=1===(s=function(e){const t=[],n=e.length;let r=null,i=0,o="",s,a,u;function l(){t.push(o+e.substring(s,a)),o="",s=a+1}for(e+="",s=a=0;a<n;++a)"\\"===(u=e[a])?(o+=e.substring(s,a++),s=a):u===r?(l(),r=null,i=-1):r||(s===i&&'"'===u||s===i&&"'"===u?(s=a+1,r=u):"."!==u||i?"["===u?(a>s&&l(),i=s=a+1):"]"===u&&(i||Br("Access path missing open bracket: "+e),0<i&&l(),i=0,s=a+1):a>s?l():s=a+1);return i&&Br("Access path missing closing bracket: "+e),r&&Br("Access path missing closing quote: "+e),a>s&&(a++,l()),t}(n="id")).length?s[0]:n,kr((a&&a.get||function(e){return 1===e.length?Cr(e[0]):Rr(e)})(s),[n],Lr||n),kr(e=>e,[],"identity"),kr(()=>0,[],"zero"),kr(()=>1,[],"one"),kr(()=>!0,[],"true"),kr(()=>!1,[],"false");var Ur="struct Uniforms {\n  resolution: vec2<f32>,\n  offset: vec2<f32>,\n};\n\n@group(0) @binding(0) var<uniform> uniforms : Uniforms;\n\nstruct VertexInput {\n  @location(0) position: vec2<f32>,\n}\n\nstruct InstanceInput {\n  @location(1) center: vec2<f32>,\n  @location(2) scale: vec2<f32>,\n  @location(3) fill_color: vec4<f32>,\n  @location(4) stroke_color: vec4<f32>,\n  @location(5) strokewidth: f32,\n  @location(6) corner_radii: vec4<f32>,\n}\n\nstruct VertexOutput {\n  @builtin(position) pos: vec4<f32>,\n  @location(0) uv: vec2<f32>,\n  @location(1) fill: vec4<f32>,\n  @location(2) stroke: vec4<f32>,\n  @location(3) strokewidth: f32,\n  @location(4) corner_radii: vec4<f32>,\n  @location(5) scale: vec2<f32>,\n}\n\n@vertex\nfn main_vertex(\n    model: VertexInput,\n    instance: InstanceInput\n) -> VertexOutput {\n    var output: VertexOutput;\n    var u = uniforms.resolution;\n    var scale = instance.scale + vec2<f32>(instance.strokewidth, instance.strokewidth);\n    var pos = model.position * scale + instance.center - uniforms.offset - vec2<f32>(instance.strokewidth, instance.strokewidth) / 2.0;\n    pos = pos / u;\n    pos.y = 1.0 - pos.y;\n    pos = pos * 2.0 - 1.0;\n    output.pos = vec4<f32>(pos, 0.0, 1.0);\n    output.uv = vec2<f32>(model.position.x, 1.0 - model.position.y);\n    output.fill = instance.fill_color;\n    output.stroke = instance.stroke_color;\n    output.strokewidth = instance.strokewidth;\n    output.corner_radii = instance.corner_radii;\n    output.scale = instance.scale;\n    return output;\n}\n\n@fragment\nfn main_fragment(in: VertexOutput) -> @location(0) vec4<f32> {\n    var col: vec4<f32> = in.fill;\n    let sw: vec2<f32> = vec2<f32>(in.strokewidth, in.strokewidth) / in.scale;\n    if in.uv.x < sw.x || in.uv.x > 1.0 - sw.x {\n        col = in.stroke;\n    }\n    if in.uv.y < sw.y || in.uv.y > 1.0 - sw.y {\n        col = in.stroke;\n    }\n    return col;\n}\n\nfn roundedBox(center: vec2<f32>, size: vec2<f32>, radius: vec4<f32>) -> f32 {\n    var rad = radius;\n    if center.x > 0.0 {\n        rad.x = radius.x;\n        rad.y = radius.y;\n    } else {\n        rad.x = radius.z;\n        rad.y = radius.w;\n    }\n    if center.y > 0.0 {\n        rad.x = rad.y;\n    }\n    var q = abs(center) - size + rad.x;\n    return min(max(q.x, q.y), 0.0) + length(max(q, vec2<f32>(0.0))) - rad.x;\n}\n";function Tr(e){d.Renderer.call(this,e),this._options={},this._redraw=!1,this._dirty=new d.Bounds,this._tempb=new d.Bounds}var a,Mr=d.Renderer.prototype;o=Tr,a=d.Renderer,s={initialize:function(e,t,n,r){this._canvas=document.createElement("canvas");var i=this._canvas.getContext("webgpu"),i=(this._textCanvas=document.createElement("canvas"),this._textContext=this._textCanvas.getContext("2d"),e&&(e.setAttribute("style","position: relative;"),this._canvas.setAttribute("class","marks"),this._textCanvas.setAttribute("class","textCanvas"),this._textCanvas.style.position="absolute",this._textCanvas.style.top="0",this._textCanvas.style.left="0",this._textCanvas.style.zIndex="10",this._textCanvas.style.pointerEvents="none",d.domClear(e,0),e.appendChild(this._canvas),e.appendChild(this._textCanvas)),this._canvas._textCanvas=this._textCanvas,i._textContext=this._textContext,(i._renderer=this)._bgcolor="#ffffff",this._uniforms={resolution:[t,n],origin:r,dpi:window.devicePixelRatio||1},i._uniforms=this._uniforms,i._pathCache={},i._pathCacheSize=0,i._geometryCache={},i._geometryCacheSize=0,this._ctx=i,{});return i.renderBatch=!0,i.simpleLine=!0,i.debugLog=!1,i.cacheShapes=!1,i.renderLock=!0,this.wgOptions=i,this._renderCount=0,Mr.initialize.call(this,e,t,n,r)},resize:function(e,t,n){var r,i,o,s,a,u,l,c;return Mr.resize.call(this,e,t,n),r=this._canvas,i=this._ctx,o=this._width,s=this._height,a=this._origin,u=this._textCanvas,l=this._textContext,c="undefined"!=typeof HTMLElement&&r instanceof HTMLElement&&null!=r.parentNode?window.devicePixelRatio:1,r.width=o*c,r.height=s*c,u.width=o*c,u.height=s*c,l.pixelRatio=c,l.setTransform(c,0,0,c,c*a[0],c*a[1]),1!==c&&(r.style.width=o+"px",r.style.height=s+"px"),i._lineWidth=c,i._viewport={x:0,y:0,width:o,height:s,minDepth:0,maxDepth:1},i._origin=a,i._ratio=c,i._clip=[0,0,r.width,r.height],1!==(window.devicePixelRatio||1)&&(this._textCanvas.style.width=e+"px",this._textCanvas.style.height=t+"px"),this._uniforms={resolution:[e,t],origin:n,dpi:window.devicePixelRatio||1},this._ctx._uniforms=this._uniforms,this._redraw=!0,this},canvas:function(){return this._canvas},textCanvas:function(){return this._textCanvas},context:function(){return this._ctx||null},textContext:function(){return this._textContext||null},device:function(){return this._device||null},dirty:function(e){for(var t=this._tempb.clear().union(e.bounds),n=e.mark.group;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_reinit:function(){return V(this,void 0,void 0,function(){var t,n,r,i;return p(this,function(e){switch(e.label){case 0:return t=this.device(),n=this.context(),t&&n?[3,3]:[4,navigator.gpu.requestAdapter({powerPreference:"high-performance"})];case 1:return[4,(r=e.sent()).requestDevice()];case 2:t=e.sent(),this._adapter=r,this._device=t,i=navigator.gpu.getPreferredCanvasFormat(),w.colorFormat=i,(n=this._canvas.getContext("webgpu")).configure({device:t,format:i,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:"premultiplied"}),this._ctx=n,this.cacheShaders(),this._renderPassDescriptor=w.createRenderPassDescriptor("Bundler",this.clearColor(),this.depthTexture().createView()),e.label=3;case 3:return[2,{device:t,ctx:n}]}})})},_render:function(h){var e=this;if(!this.wgOptions.renderLock||!this._isRendering)return this._isRendering=!0,V(e,void 0,void 0,function(){var i,o,s,a,u,l,c,f=this;return p(this,function(e){switch(e.label){case 0:return[4,this._reinit()];case 1:return o=e.sent(),i=o.device,o=o.ctx,w.startFrame(),u=this._origin,s=this._width,a=this._height,t=u,n=s,r=a,u=(new d.Bounds).set(0,0,n,r).translate(-t[0],-t[1]),o._tx=0,o._ty=0,this.clear(),l=performance.now(),this.draw(i,o,h,u),c=performance.now(),this._renderPassDescriptor.colorAttachments[0].view=o.getCurrentTexture().createView(),[4,w.submitQueue2(i,this._renderPassDescriptor)];case 2:return e.sent(),requestAnimationFrame(function(){return f.renderlock(l,c)}),[2]}var t,n,r})}),this;this._lastRenderCallback=function(){return e._render(h)}},renderlock:function(e,t){var n;!0===this.wgOptions.debugLog&&(n=performance.now(),console.log("Render Time (".concat(this._renderCount++,"): ").concat((n-e).toFixed(3),"ms (Draw: ").concat((t-e).toFixed(3),"ms, WebGPU: ").concat((n-t).toFixed(3),"ms)"))),this._isRendering=!1,this.wgOptions.renderLock&&this._lastRenderCallback&&(e=this._lastRenderCallback,this._lastRenderCallback=null,e())},frame:function(){return this._lastScene&&this._render(this._lastScene,[]),this},draw:function(e,t,n,r){var i=Sr[n.marktype];null==i?console.error("Unknown mark type: '".concat(n.marktype,"'")):(t.depthTexture=this.depthTexture(),t.background=this.clearColor(),i.draw.call(this,e,t,n,r))},clear:function(){var e=this.device(),t={label:"Background",colorAttachments:[{view:this.context().getCurrentTexture().createView(),loadOp:"clear",storeOp:"store",clearValue:this.clearColor()}]},n=e.createCommandEncoder(),t=(n.beginRenderPass(t).end(),e.queue.submit([n.finish()]),this.textContext());t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.textCanvas().width,this.textCanvas().height),t.restore()},depthTexture:function(){return null!=this._depthTexture&&this._depthTexture.device===this._device&&this._depthTexture.width===this.canvas().width&&this._depthTexture.height===this.canvas().height||(this._depthTexture=this.device().createTexture({size:[this.canvas().width,this.canvas().height,1],format:w.depthFormat,dimension:"2d",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this._depthTexture.device=this._device,this._renderPassDescriptor=w.createRenderPassDescriptor("Bundler",this.clearColor(),this.depthTexture().createView())),this._depthTexture},clearColor:function(){return this._bgcolor?U.from(this._bgcolor):{r:1,g:1,b:1,a:1}},cacheShaders:function(){var e=this.device(),t=this.context();t._shaderCache={},t._shaderCache.Symbol=e.createShaderModule({code:"struct Uniforms {\n  resolution: vec2<f32>,\n  offset: vec2<f32>,\n}\n\n@group(0) @binding(0) var<uniform> uniforms : Uniforms;\n\nstruct VertexInput {\n  @location(0) position: vec2<f32>,\n}\n\nstruct InstanceInput {\n  @location(1) center: vec2<f32>,\n  @location(2) radius: f32,\n  @location(3) fill_color: vec4<f32>,\n  @location(4) stroke_color: vec4<f32>,\n  @location(5) stroke_width: f32,\n}\n\nstruct VertexOutput {\n  @builtin(position) pos: vec4<f32>,\n  @location(0) uv: vec2<f32>,\n  @location(1) fill: vec4<f32>,\n  @location(2) stroke_color: vec4<f32>,\n  @location(3) stroke_width_percent: f32,\n}\n\nconst smooth_width = 0.05;\n\n@vertex\nfn main_vertex(\n    model: VertexInput,\n    instance: InstanceInput\n) -> VertexOutput {\n    var output: VertexOutput;\n    var stroke_width = instance.stroke_width / 2.0;\n    var radius_with_stroke = instance.radius + stroke_width;\n    var smooth_adjusted_radius = radius_with_stroke * 2.0 / (2.0 - smooth_width * 2.0);\n    var pos = vec2<f32>(model.position * smooth_adjusted_radius) + instance.center - uniforms.offset;\n    pos = pos / uniforms.resolution;\n    pos.y = 1.0 - pos.y;\n    pos = pos * 2.0 - 1.0;\n    output.pos = vec4<f32>(pos, 0.0, 1.0);\n    output.uv = model.position / 2.0 + vec2<f32>(0.5, 0.5);\n    output.fill = instance.fill_color;\n    output.stroke_color = instance.stroke_color;\n    output.stroke_width_percent = stroke_width / radius_with_stroke;\n    return output;\n}\n\n@fragment\nfn main_fragment(in: VertexOutput) -> @location(0) vec4<f32> {\n    let distance = distance(vec2<f32>(0.5, 0.5), in.uv);\n    let smoothOuter: f32 = smoothstep(0.0, smooth_width, 0.5 - distance);\n    let smoothInner: f32 = 1.0 - smoothstep(in.stroke_width_percent - smooth_width / 2.0, in.stroke_width_percent + smooth_width / 2.0, 0.5 - distance);\n    return mix(vec4<f32>(in.fill.rgb, in.fill.a * smoothOuter), vec4<f32>(in.stroke_color.rgb, in.stroke_color.a * smoothOuter), smoothInner);\n}\n\nfn binaryIndicator(value: f32, edge0: f32, edge1: f32) -> f32 {\n    if edge0 == edge1 {\n        return 0.0;\n    }\n    let t = saturate((value - edge0) / (edge1 - edge0));\n    return ceil(t);\n}",label:"Symbol Shader"}),t._shaderCache.Line=e.createShaderModule({code:"\nstruct VertexInput {\n    @location(0) start: vec2<f32>,\n    @location(1) end: vec2<f32>,\n    @location(2) color: vec4<f32>,\n    @location(3) stroke_width: f32,\n    @location(4) resolution: vec2<f32>,\n    @location(5) offset: vec2<f32>,\n};\n\n\nstruct VertexOutput {\n    @builtin(position) pos: vec4<f32>,\n    @location(0)  uv: vec2<f32>,\n    @location(1) fill: vec4<f32>,\n    @location(2) smooth_width: f32,\n};\n\nconst smooth_step = 1.5;\n\n@vertex\nfn main_vertex(in: VertexInput, @builtin(vertex_index) vertexIndex: u32) -> VertexOutput {\n    let start = in.start;\n    let end = in.end;\n    let color = in.color;\n    let stroke_width = in.stroke_width;\n\n    // Calculate the direction vector of the line\n    let direction = normalize(end - start);\n    let angle = atan2(direction.y, direction.x);\n\n    // Calculate the normal vector\n    let normal = normalize(vec2<f32>(-direction.y, direction.x));\n\n    // Calculate the offset for width\n    let adjusted_width = stroke_width + smooth_step;\n    let offset = normal * ((adjusted_width) * 0.5);\n    let width = stroke_width + smooth_step * 2.0;\n    let length = length(end - start);\n\n    // Calculate the four points of the line\n    var p1 = start - offset;\n    var p2 = start + offset;\n    var p3 = end - offset;\n    var p4 = end + offset;\n\n    var vertices = array(p1, p2, p3, p2, p4, p3);\n    var uvs = array(\n        vec2<f32>(0.0, 0.0),\n        vec2<f32>(1.0, 0.0),\n        vec2<f32>(0.0, 1.0),\n        vec2<f32>(1.0, 0.0),\n        vec2<f32>(1.0, 1.0),\n        vec2<f32>(0.0, 1.0)\n    );\n    var pos = vertices[vertexIndex];\n    pos = (pos - in.offset) / in.resolution;\n    pos.y = 1.0 - pos.y;\n    pos = pos * 2.0 - 1.0;\n\n    var out: VertexOutput;\n    out.pos = vec4<f32>(pos, 0.0, 1.0);\n    out.uv = uvs[vertexIndex];\n    out.fill = color;\n    out.smooth_width = adjusted_width / stroke_width - 1.0;\n    return out;\n}\n\n@fragment\nfn main_fragment(in: VertexOutput) -> @location(0) vec4<f32> {\n    let sx = abs(in.uv.x - 0.5) * 2.0;\n    let sy = abs(in.uv.y - 0.5) * 2.0;\n    let aax: f32 = 1.0 - smoothstep(1.0 - in.smooth_width, 1.0, sx);\n    // let aay: f32 = 1.0 - smoothstep(1.0 - in.smooth_length, 1.0, sy);\n    return vec4<f32>(in.fill.rgb, in.fill.a * aax);\n}",label:"Line Shader"}),t._shaderCache.Rule=e.createShaderModule({code:"struct Uniforms {\n    resolution: vec2<f32>,\n    offset: vec2<f32>,\n}\n\n@group(0) @binding(0) var<uniform> uniforms: Uniforms;\n\nstruct VertexInput {\n    @location(0) position: vec2<f32>,\n    @location(1) center: vec2<f32>,\n    @location(2) scale: vec2<f32>,\n    @location(3) stroke_color: vec4<f32>,\n}\n\nstruct VertexOutput {\n    @builtin(position) pos: vec4<f32>,\n    @location(1) stroke: vec4<f32>,\n}\n\n@vertex\nfn main_vertex(in: VertexInput) -> VertexOutput {\n    var output : VertexOutput;\n    var u = uniforms.resolution;\n    var axis_offsets = calculateAxisWidthOffsets(in.scale);\n    var pos = in.position * in.scale  + in.center - uniforms.offset - axis_offsets;\n    pos = pos / uniforms.resolution;\n    pos.y = 1.0 - pos.y;\n    pos = pos * 2.0 - 1.0;\n    output.pos = vec4<f32>(pos, 0.0, 1.0);\n    output.stroke = in.stroke_color;\n    return output;\n}\n\n@fragment\nfn main_fragment(in: VertexOutput) -> @location(0) vec4<f32> {\n    return in.stroke;\n}\n\nfn calculateAxisWidthOffsets(inScale: vec2<f32>) -> vec2<f32> {\n    var x_width_offset = inScale.x;\n    var y_width_offset = inScale.y;\n\n    // one of them should be exactly 1.0 as its either a y or a x axis.\n    if (x_width_offset > 1.0) {\n        x_width_offset = 0.0;\n    }\n    if (y_width_offset > 1.0) {\n        y_width_offset = 0.0;\n    }\n    return vec2<f32>(x_width_offset / 2.0, y_width_offset / 2.0);\n}",label:"Rule Shader"}),t._shaderCache.SLine=e.createShaderModule({code:"struct Uniforms {\n    resolution: vec2<f32>,\n    offset: vec2<f32>,\n};\n\n@group(0) @binding(0) var<uniform> uniforms: Uniforms;\n\nstruct VertexInput {\n    @location(0) start: vec2<f32>,\n    @location(1) end: vec2<f32>,\n    @location(2) color: vec4<f32>,\n    @location(3) stroke_width: f32,\n};\n\n\nstruct VertexOutput {\n    @builtin(position) pos: vec4<f32>,\n    @location(0)  uv: vec2<f32>,\n    @location(1) fill: vec4<f32>,\n};\n\n@vertex\nfn main_vertex(in: VertexInput, @builtin(vertex_index) vertexIndex: u32) -> VertexOutput {\n    let start = in.start;\n    let end = in.end;\n    let color = in.color;\n    let stroke_width = in.stroke_width;\n\n    // Calculate the direction vector of the line\n    let direction = normalize(end - start);\n    let angle = atan2(direction.y, direction.x);\n\n    // Calculate the normal vector\n    let normal = normalize(vec2<f32>(-direction.y, direction.x));\n\n    // Calculate the offset for width\n    let offset = normal * ((stroke_width) * 0.5);\n\n    // Calculate the four points of the line\n    var p1 = start - offset;\n    var p2 = start + offset;\n    var p3 = end - offset;\n    var p4 = end + offset;\n\n    var vertices = array(p1, p2, p3, p4, p2, p3);\n    var pos = vertices[vertexIndex];\n    pos = (pos - uniforms.offset) / uniforms.resolution;\n    pos.y = 1.0 - pos.y;\n    pos = pos * 2.0 - 1.0;\n\n    var out: VertexOutput;\n    out.pos = vec4<f32>(pos, 0.0, 1.0);\n    let rotatedUV = vertices[vertexIndex] + uniforms.offset;\n    var len = length(pos.xy);\n    out.uv = vec2<f32>(- pos.x / len, pos.y / len);\n    out.fill = color;\n    return out;\n}\n\n@fragment\nfn main_fragment(in: VertexOutput) -> @location(0) vec4<f32> {\n    return in.fill;\n}",label:"SLine Shader"}),t._shaderCache.Path=e.createShaderModule({code:"struct Uniforms {\n  resolution: vec2<f32>,\n  offset: vec2<f32>,\n}\n\n@group(0) @binding(0) var<uniform> uniforms : Uniforms;\n\nstruct VertexInput {\n  @location(0) position: vec3<f32>,\n  @location(1) fill_color: vec4<f32>,\n}\n\nstruct VertexOutput {\n  @builtin(position) pos: vec4<f32>,\n  @location(0) uv: vec2<f32>,\n  @location(1) fill: vec4<f32>,\n}\n\n@vertex\nfn main_vertex(\n    model: VertexInput\n) -> VertexOutput {\n    var output: VertexOutput;\n    var pos = model.position.xy - uniforms.offset;\n    pos = pos / uniforms.resolution;\n    pos.y = 1.0 - pos.y;\n    pos = pos * 2.0 - 1.0;\n    output.pos = vec4<f32>(pos, model.position.z + 0.5, 1.0);\n    output.uv = pos;\n    output.fill = model.fill_color;\n    return output;\n}\n\n@fragment\nfn main_fragment(in: VertexOutput) -> @location(0) vec4<f32> {\n    return in.fill;\n}\n",label:"Triangle Shader"}),t._shaderCache.Rect=e.createShaderModule({code:Ur,label:"Rect Shader"}),t._shaderCache.Group=e.createShaderModule({code:Ur,label:"Group Shader"}),t._shaderCache.Arc=e.createShaderModule({code:"struct Uniforms {\r\n  resolution: vec2<f32>,\r\n  offset: vec2<f32>,\r\n}\r\n\r\n@group(0) @binding(0) var<uniform> uniforms : Uniforms;\r\n\r\nstruct VertexInput {\r\n  @location(0) position: vec3<f32>,\r\n  @location(1) fill_color: vec4<f32>,\r\n}\r\n\r\nstruct InstanceInput {\r\n  @location(2) center: vec2<f32>,\r\n}\r\n\r\nstruct VertexOutput {\r\n  @builtin(position) pos: vec4<f32>,\r\n  @location(0) uv: vec2<f32>,\r\n  @location(1) fill: vec4<f32>,\r\n}\r\n\r\n@vertex\r\nfn main_vertex(\r\n    model: VertexInput,\r\n    instance: InstanceInput\r\n) -> VertexOutput {\r\n    var output: VertexOutput;\r\n    var pos = model.position.xy + instance.center - uniforms.offset;\r\n    pos = pos / uniforms.resolution;\r\n    pos.y = 1.0 - pos.y;\r\n    pos = pos * 2.0 - 1.0;\r\n    output.pos = vec4<f32>(pos, model.position.z + 0.5, 1.0);\r\n    output.uv = pos;\r\n    output.fill = model.fill_color;\r\n    return output;\r\n}\r\n\r\n@fragment\r\nfn main_fragment(in: VertexOutput) -> @location(0) vec4<f32> {\r\n    return in.fill;\r\n}\r\n",label:"Arc Shader"}),t._shaderCache.Shape=e.createShaderModule({code:"struct Uniforms {\r\n  resolution: vec2<f32>,\r\n  offset: vec2<f32>,\r\n}\r\n\r\n@group(0) @binding(0) var<uniform> uniforms : Uniforms;\r\n\r\nstruct VertexInput {\r\n  @location(0) position: vec3<f32>,\r\n  @location(1) fill_color: vec4<f32>,\r\n}\r\n\r\nstruct VertexOutput {\r\n  @builtin(position) pos: vec4<f32>,\r\n  @location(0) uv: vec2<f32>,\r\n  @location(1) fill: vec4<f32>,\r\n}\r\n\r\n@vertex\r\nfn main_vertex(\r\n    model: VertexInput,\r\n) -> VertexOutput {\r\n    var output: VertexOutput;\r\n    var pos = model.position.xy - uniforms.offset;\r\n    pos = pos / uniforms.resolution;\r\n    pos.y = 1.0 - pos.y;\r\n    pos = pos * 2.0 - 1.0;\r\n    output.pos = vec4<f32>(pos, model.position.z + 0.5, 1.0);\r\n    output.uv = pos;\r\n    output.fill = model.fill_color;\r\n    return output;\r\n}\r\n\r\n@fragment\r\nfn main_fragment(in: VertexOutput) -> @location(0) vec4<f32> {\r\n    return in.fill;\r\n}\r\n",label:"Shape Shader"}),t._shaderCache.Area=e.createShaderModule({code:"struct Uniforms {\r\n  resolution: vec2<f32>,\r\n  offset: vec2<f32>,\r\n}\r\n\r\n@group(0) @binding(0) var<uniform> uniforms : Uniforms;\r\n\r\nstruct VertexInput {\r\n  @location(0) position: vec3<f32>,\r\n  @location(1) fill_color: vec4<f32>,\r\n}\r\n\r\nstruct VertexOutput {\r\n  @builtin(position) pos: vec4<f32>,\r\n  @location(0) uv: vec2<f32>,\r\n  @location(1) fill: vec4<f32>,\r\n}\r\n\r\n@vertex\r\nfn main_vertex(\r\n    model: VertexInput\r\n) -> VertexOutput {\r\n    var output: VertexOutput;\r\n    var pos = model.position.xy - uniforms.offset;\r\n    pos = pos / uniforms.resolution;\r\n    pos.y = 1.0 - pos.y;\r\n    pos = pos * 2.0 - 1.0;\r\n    output.pos = vec4<f32>(pos, model.position.z + 0.5, 1.0);\r\n    output.uv = pos;\r\n    output.fill = model.fill_color;\r\n    return output;\r\n}\r\n\r\n@fragment\r\nfn main_fragment(in: VertexOutput) -> @location(0) vec4<f32> {\r\n    return in.fill;\r\n}\r\n",label:"Area Shader"})}},a=o.prototype=Object.create(a.prototype),Object.defineProperty(a,"constructor",{value:o,writable:!0,enumerable:!0,configurable:!0}),function(i){for(let e,t,n=1,r=arguments.length;n<r;++n)for(t in e=arguments[n])i[t]=e[t]}(a,s),d.CanvasHandler.prototype.context=function(){return this._canvas.getContext("2d")||this._canvas._textCanvas.getContext("2d")},d.renderModule("webgpu",{handler:d.CanvasHandler,renderer:Tr}),u.WebGPURenderer=Tr});